<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en,zh-Hans,default">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="YouShouldKnow" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta property="og:type" content="website">
<meta property="og:title" content="YouShouldKnow">
<meta property="og:url" content="http://blog.youshouldknow.tech/index.html">
<meta property="og:site_name" content="YouShouldKnow">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YouShouldKnow">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.youshouldknow.tech/">





  <title>YouShouldKnow</title>
  














</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YouShouldKnow</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">The world is wonderful, you should know more</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2020/02/23/æ—¥å¸¸å­¦ä¹ è‹±è¯­æ€»ç»“/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/23/æ—¥å¸¸å­¦ä¹ è‹±è¯­æ€»ç»“/" itemprop="url">æ—¥å¸¸å­¦ä¹ è‹±è¯­æ€»ç»“</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-23T22:36:51+08:00">
                2020-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/æˆé•¿/" itemprop="url" rel="index">
                    <span itemprop="name">æˆé•¿</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="æ—¥å¸¸å­¦ä¹ è‹±è¯­æ–¹æ³•æ±‡æ€»"><a href="#æ—¥å¸¸å­¦ä¹ è‹±è¯­æ–¹æ³•æ±‡æ€»" class="headerlink" title="æ—¥å¸¸å­¦ä¹ è‹±è¯­æ–¹æ³•æ±‡æ€»"></a>æ—¥å¸¸å­¦ä¹ è‹±è¯­æ–¹æ³•æ±‡æ€»</h2><p><em>ç›®æ ‡æ˜ç¡®ï¼š</em></p>
<p>ä¸»è¦ç›®æ ‡æ˜¯æå‡é˜…è¯»èƒ½åŠ›ï¼Œè¿™æ ·å¯ä»¥è¯»è‹±æ–‡æ•°æ®æˆ–è€…æ–‡çŒ®æ—¶æ›´åŠ è‡ªå¦‚ã€‚</p>
<p>æ¬¡è¦ç›®æ ‡æ˜¯æå‡å¬åŠ›ï¼Œå¯ä»¥å¬æ‡‚ç¾å‰§æˆ–è€…å›½å¤–ç”µå½±ä»¥åŠyoutubeçš„å›½å¤–upä¸»ã€‚</p>
<p>æœ€åé¡ºå¸¦ç€ç»ƒä¹ å‘éŸ³ï¼Œå› ä¸ºåœ¨è®­ç»ƒå¬åŠ›çš„è¿‡ç¨‹ä¸­ï¼Œç»ƒä¹ å‘éŸ³èƒ½æå‡åˆ†è¾¨å‘éŸ³çš„èƒ½åŠ›ï¼Œä¿ƒè¿›å¬åŠ›çš„è¿›æ­¥ã€‚</p>
<p><em>æˆ‘çš„å­¦ä¹ æ¡†æ¶ï¼š</em></p>
<p>ä»¥é˜…è¯»ä¹¦ç±ä¸ºä¸»ï¼Œä¿è¯é˜…è¯»é‡ç»´æŒé˜…è¯»çš„æ„Ÿè§‰ï¼Œä»è€Œåœ¨æœ‰è¯­å¢ƒçš„æƒ…å†µä¸‹ç§¯ç´¯å•è¯ã€‚å•è¯éœ€è¦åå¤å¤ä¹ ï¼Œæ­£å¯¹é—å¿˜ã€‚å¬åŠ›åˆ™æ˜¯é€šè¿‡åå¤å¬é˜…è¯»çš„ä¹¦ç±ä¸ºä¸»ï¼Œä¹ŸåŒ…æ‹¬çœ‹ç¾å‰§ã€‚å‘éŸ³ä¸»è¦æ˜¯è‡ªå·±æœ—è¯»ä¹¦ç±å’Œå¬çš„è¿›è¡Œæ¯”è¾ƒã€‚ä¸‹é¢åˆ†åˆ«è¯¦ç»†ä»‹ç»ä¸€ä¸‹é˜…è¯»ï¼Œå•è¯ï¼Œå¬åŠ›ï¼Œå‘éŸ³çš„æ–¹æ³•ã€‚</p>
<h3 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h3><p>é˜…è¯»æˆ‘ä¸»è¦æ¨èä¸¤ç§æ–¹å¼ï¼Œçœ‹ä¹¦ç±å’Œæ–°é—»ã€‚</p>
<h4 id="ä¹¦ç±ï¼š"><a href="#ä¹¦ç±ï¼š" class="headerlink" title="ä¹¦ç±ï¼š"></a>ä¹¦ç±ï¼š</h4><p>ä¹¦ç±é€‰æ‹©å¯ä»¥å‚è€ƒä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¸¦å½±è§†ä½œå“ï¼Œè¿™æ ·å¯ä»¥æå‰äº†è§£å¤§è‡´çš„å†…å®¹ï¼Œåœ¨é˜…è¯»æ—¶æ›´åŠ å®¹æ˜“ç†è§£</li>
<li>éš¾åº¦é€‚ä¸­ï¼Œå†…å®¹ä¸æ˜¯ç‰¹åˆ«ä¸“ä¸šåŒ–çš„ï¼Œå…·æœ‰æ™®éæ€§</li>
<li>è¶£å‘³æ€§ï¼Œçœ‹ç®€ä»‹è§‰å¾—è‡ªå·±æ„Ÿå…´è¶£ï¼Œè¿™æ ·æ‰æœ‰è¯»ä¸‹å»çš„åŠ¨åŠ›ï¼Œè€Œä¸”ä¸å…‰æ”¶è·è‹±è¯­èƒ½åŠ›ä¹Ÿæ”¶è·äº†å›½å¤–çš„ä¸€äº›æ€æƒ³</li>
</ul>
<blockquote>
<p>ã€ŠTuesdays With Morrieã€‹ã€ŠThe Fault In Out Starsã€‹ã€ŠHarry Potter and the Philosopherâ€™s Stoneã€‹</p>
</blockquote>
<p>é˜…è¯»æ–¹å¼ï¼š</p>
<ul>
<li>æ¯å¤©æ ¹æ®å½“å¤©çš„æ—¶é—´å……è£•ç¨‹åº¦é˜…è¯»åŠä¸ªå°æ—¶åˆ°ä¸€ä¸ªå°æ—¶ï¼Œåˆ†ä¸¤éé˜…è¯»<ul>
<li>ç¬¬ä¸€éï¼šè¿…é€Ÿè¿‡ä¸€éï¼Œç†è§£å¤§æ„ï¼ˆåŸ¹å…»é€Ÿåº¦èƒ½åŠ›ï¼Œå³èå…¥è¯­å¢ƒï¼Œç†è§£å«ä¹‰ï¼‰ï¼›ç•™æ„ä¸èƒ½ç†è§£æˆ–è¡¨ç¤ºæ€€ç–‘çš„åœ°æ–¹ï¼›ç”¨é»‘ç¬”ç”»å‡ºç”Ÿè¯ï¼›</li>
<li>ç¬¬äºŒéï¼šå¯¹ç…§ä¸­æ–‡ç¿»è¯‘ï¼Œç»†çœ‹ä¸€éå¯»æ‰¾ç†è§£é”™çš„åœ°æ–¹ï¼Œä¸”ç€é‡çœ‹ç¬¬ä¸€éä¸èƒ½ç†è§£çš„åœ°æ–¹ï¼Œåˆ†æç†è§£å¤±è´¥çš„åŸå› ï¼ˆå…³é”®ç”Ÿè¯/è¯­æ³•/æ„è±¡è¯­å¢ƒç†è§£é”™è¯¯ï¼‰ï¼›æ·»åŠ å…³é”®ç”Ÿè¯å…¥å•è¯æœ¬ï¼ˆå…³é”®ç¨‹åº¦ç”±æ•´ä½“ç”Ÿè¯é‡ä»¥åŠå½“å¤©å­¦ä¹ æ—¶é—´å†³å®šï¼‰ï¼›</li>
</ul>
</li>
<li>å…¨ä¹¦é˜…è¯»å®Œä¹‹åï¼Œæ¯å¤©ä»¥é˜…è¯»çš„å¿ƒæ€é˜…è¯»ä¸€ç« ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¾ˆå¿«ï¼Œå› ä¸ºä¹‹å‰å·²ç»ç²¾è¯»è¿‡ä¸€éã€‚æŸ¥æ¼è¡¥ç¼ºï¼Œå¯¹é—æ¼æˆ–è€…æ²¡æœ‰åŠ å…¥çš„ç”Ÿè¯è¿›è¡Œæ·»åŠ ï¼Œå¯¹ç†è§£ä¾æ—§æœ‰é—®é¢˜çš„åœ°æ–¹è¿›è¡Œåˆ†æã€‚</li>
</ul>
<h4 id="æ–°é—»ï¼š"><a href="#æ–°é—»ï¼š" class="headerlink" title="æ–°é—»ï¼š"></a>æ–°é—»ï¼š</h4><p>æ–°é—»æ—¶é«˜åº¦å‡ç»ƒçš„æ–‡å­—ï¼Œç”¨ç²¾ç‚¼çš„è¯æŠŠäº‹æƒ…è¯´æ¸…æ¥šï¼Œå› æ­¤é€šè¿‡çœ‹æ–°é—»ç§¯ç´¯é‡å¤å‡ºç°çš„å¥å¼ï¼Œæœ‰åŠ©äºæå‡å†™ä½œèƒ½åŠ›ã€‚</p>
<blockquote>
<p>BBC News</p>
</blockquote>
<h3 id="å•è¯"><a href="#å•è¯" class="headerlink" title="å•è¯"></a>å•è¯</h3><blockquote>
<p>ä½¿ç”¨App<code>å¢¨å¢¨èƒŒå•è¯</code>è¿›è¡Œå•è¯çš„è®°å¿†ã€‚å¢¨å¢¨èƒŒå•è¯æ ¹æ®è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿å®‰æ’å•è¯çš„å¤ä¹ ï¼Œæ–°è¯å’Œå¤ä¹ çš„å•è¯éƒ½ä¼šè¿›è¡ŒèƒŒè¯µã€‚ä¸”å¯ä»¥è‡ªå®šä¹‰ä¾‹å¥ï¼ˆä¹¦ä¸­çš„å¥å­ï¼‰å’ŒåŠ©è®°ã€‚ä¸”å¾ˆæ–¹ä¾¿æŸ¥æ‰¾è¯æºã€‚æ¯å¤©å¤§æ¦‚èƒŒè¯µ40åˆ†é’Ÿã€‚å¤§æ¦‚100ä¸ªå•è¯å·¦å³ã€‚å¹³å‡ä¸€ä¸ªå•è¯30sä»¥å†…ã€‚</p>
</blockquote>
<p>æ³¨æ„èƒŒè¯µå•è¯æ—¶ï¼Œè„‘æµ·ä¸­æœ€å¥½æœ‰å½“æ—¶ä¹¦ç±ä¸­çš„è¯­å¢ƒå’Œæ„è±¡ï¼Œå› ä¸ºè¯­è¨€æ˜¯å’ŒæŒ‡ä»£äº‹ç‰©çš„ä¸€ç§æ˜ å°„ï¼Œä¸å¯æœ¬æœ«å€’ç½®æ ¹æ®ä¸­æ–‡ç¿»è¯‘è‹±æ–‡ã€‚å¦‚æœæƒ³ä¸èµ·æ¥ï¼Œå¯ä»¥ç¿»ä¹¦å›é¡¾ï¼Œå¹¶æŠŠå¥å­å¡«å……è¿›ä¾‹å¥ã€‚</p>
<h3 id="å¬åŠ›"><a href="#å¬åŠ›" class="headerlink" title="å¬åŠ›"></a>å¬åŠ›</h3><p>å¬åŠ›å°±æ˜¯ä¸æ–­çš„é‡å¤å¬ï¼ˆå½“ç„¶è¦èƒ½å¬æ‡‚åœ¨è®²å•¥ï¼Œæ‰€ä»¥ä¸»è¦æ–¹å¼æ˜¯å¬é˜…è¯»è¿‡çš„ä¹¦ï¼‰ã€‚</p>
<p>æ–¹æ¡ˆä¸€ï¼šå¬ä¹¦ã€‚</p>
<blockquote>
<p>ä½¿ç”¨App<code>Audible</code>è¿›è¡Œå¬ä¹¦ã€‚<code>Audible</code>æ˜¯Amazonçš„ä¸€æ¬¾å¬ä¹¦appã€‚é‡Œé¢å†…å®¹éå¸¸ä¸°å¯Œã€‚å…è´¹ä¼šå‘˜ä¸€ä¸ªæœˆå¯ä»¥å…è´¹å¬ä¸€æœ¬ä¹¦ä»¥åŠä¸¤æœ¬<code>Audible</code>åŸåˆ›ä¹¦ã€‚æˆ‘å½“æ—¶ä¹°äº†æœ¬æ²¹ç‚¸å”çš„å“ˆåˆ©æ³¢ç‰¹ä¸é­”æ³•çŸ³ï¼Œåé¢ä¹°çš„ä¹¦éƒ½æ˜¯é€šè¿‡æ·˜å®ä¹°çš„creditså…‘æ¢çš„ã€‚</p>
</blockquote>
<p>å¬è‹±æ–‡ä¹¦å¯ä»¥è¯´æ˜¯å‚¬çœ ç¥å™¨ï¼Œç‰¹åˆ«æ˜¯åå¤å¬ä¹‹åï¼ŒçœŸçš„æ˜¯åˆ†åˆ†é’Ÿç§’ç¡å“ˆå“ˆå“ˆå“ˆå“ˆã€‚ç›®å‰å·²ç»å¬äº†ä¸€éå“ˆåˆ©æ³¢ç‰¹ä¸é­”æ³•çŸ³ï¼Œä¸€éç›¸çº¦æ˜ŸæœŸäºŒã€‚è¿™ä¿©ç›®å‰éƒ½åœ¨å¬ç¬¬äºŒéï¼Œä¸€èˆ¬åˆç¡å¬ç›¸çº¦æ˜ŸæœŸäºŒï¼Œæ™šä¸Šå¬å“ˆåˆ©æ³¢ç‰¹ï¼ˆå°å£°bbï¼šåˆç¡éœ€è¦æ›´å¿«å…¥ç¡ï¼‰</p>
<p>æ–¹æ¡ˆäºŒï¼šé™¤äº†å¬ä¹¦ï¼Œè¿˜æœ‰çœ‹ç¾å‰§ï¼Œçœ‹youtube videoã€‚ä¸è¿‡è¿™ä¸¤è€…ç›®å‰æ•ˆæœä¸æ•¢è¯´ğŸ™Šï¼Œæ¯•ç«Ÿçœ‹çš„æ—¶å€™æœ‰å­—å¹•ä¸”å…‰çœ‹å†…å®¹çˆ½äº†ã€‚ç›®å‰åœ¨çœ‹ç¾å‰§ã€Šè€çˆ¸è€å¦ˆæµªæ¼«å²ã€‹ï¼Œä¸ä¸Šç˜¾ï¼Œä½†ä¹Ÿå¾ˆæœ‰è¶£å‘³ï¼Œè¿½åˆ°ç¬¬å››å­£å°±æ…¢æ…¢çœ‹äº†ã€‚</p>
<h3 id="å‘éŸ³"><a href="#å‘éŸ³" class="headerlink" title="å‘éŸ³"></a>å‘éŸ³</h3><p>æ¯å¤©æœ—è¯»ä¸€ç« ä¹‹å‰çœ‹è¿‡çš„å†…å®¹ï¼Œå½•éŸ³ã€‚æ‰¾å‘éŸ³åˆ«æ‰­çš„ç‚¹ï¼Œå»å¬åˆ«äººæ˜¯æ€ä¹ˆè¯»çš„ã€‚</p>
<p>åœ¨çœ‹ç¾å‰§ï¼Œyoutube videoï¼Œé‡åˆ°å–œæ¬¢çš„è¯ï¼Œè®°å½•ä¸‹æ¥ï¼Œé‡å¤å¬ï¼Œæ¨¡ä»¿ã€‚</p>
<p>çœ‹ä¸“ä¸šçš„è€å¤–å‘éŸ³çº æ­£çš„è§†é¢‘ã€‚å»ä»”ç»†ä½“ä¼šå‘éŸ³éƒ¨ä½ï¼ŒèˆŒå¤´çš„ä½ç½®ï¼Œæ°”æµçš„èµ°å‘ï¼Œå˜´å½¢ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2020/01/04/Calciteæºç é˜…è¯»ç¬”è®°/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/04/Calciteæºç é˜…è¯»ç¬”è®°/" itemprop="url">Calciteæºç é˜…è¯»ç¬”è®°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-04T23:26:12+08:00">
                2020-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/query-optimizer/" itemprop="url" rel="index">
                    <span itemprop="name">query optimizer</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‘ç°ç–‘é—®ï¼ˆfrom-csv-exampleï¼‰"><a href="#å‘ç°ç–‘é—®ï¼ˆfrom-csv-exampleï¼‰" class="headerlink" title="å‘ç°ç–‘é—®ï¼ˆfrom csv exampleï¼‰"></a>å‘ç°ç–‘é—®ï¼ˆfrom csv exampleï¼‰</h1><blockquote>
<p>Premise:</p>
<ul>
<li>å®˜ç½‘çš„tutorialçœ‹å®Œï¼Œäº†è§£äº†é€‚é…csvéœ€è¦ç¼–å†™çš„åŸºæœ¬é€»è¾‘</li>
<li>ç†Ÿæ‚‰volcano/cascadesæŸ¥è¯¢ä¼˜åŒ–æ¡†æ¶åŸç†</li>
<li>ç†Ÿæ‚‰calciteä¸­åŸºæœ¬çš„é˜¶æ®µ(parse, validate, optimize, execute)</li>
</ul>
<p>Tips:</p>
<ul>
<li>ä»¥ä¸‹çš„ä»£ç éƒ¨åˆ†ï¼Œæ•°æ®ç»“æ„ç›¸å…³éƒ½ä¼šåœ¨å‰é¢åŠ ä¸Šç«–çº¿ï¼Œé‡åˆ°è¯»ä¸ä¸‹å»ä¸å¦¨å…ˆçœ‹æ•°æ®ç»“æ„éƒ¨åˆ†çš„å®šä¹‰å†çœ‹é€»è¾‘ä»£ç åˆ†æã€‚åœ¨æœ¬æ–‡å†™å®Œæ—¶ï¼Œä¼šåšä¸€ä¸ªæ€»ç»“ï¼Œå°†æ‰€æœ‰é‡åˆ°çš„æ•°æ®ç»“æ„å®šä¹‰ä»¥åŠä¹‹é—´çš„å…³ç³»æ±‡æ€»åœ¨å‰é¢</li>
</ul>
</blockquote>
<p>ä»å®˜æ–¹çš„CSV exampleçš„æµ‹è¯•ç”¨ä¾‹å…¥æ‰‹ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ åŸºæœ¬çš„è¿è¡Œé€»è¾‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Filter that can be partly handled by CsvFilterableTable. */</span></span><br><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFilterableWhere2</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> String sql = <span class="string">"select empno, gender, name from EMPS\n"</span></span><br><span class="line">      + <span class="string">" where gender = 'F' and empno &gt; 125"</span>;</span><br><span class="line">  sql(<span class="string">"filterable-model"</span>, sql)</span><br><span class="line">      .returns(<span class="string">"EMPNO=130; GENDER=F; NAME=Alice"</span>).ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥è¯¢è¯­å¥éå¸¸ç®€å•ï¼Œå°±æ˜¯ä»EMPSè¡¨ä¸­è¯»å–æ•°æ®ï¼Œä½¿ç”¨çš„modelä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">  <span class="attr">"defaultSchema"</span>: <span class="string">"SALES"</span>,</span><br><span class="line">  <span class="attr">"schemas"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"SALES"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"custom"</span>,</span><br><span class="line">      <span class="attr">"factory"</span>: <span class="string">"org.apache.calcite.adapter.csv.CsvSchemaFactory"</span>,</span><br><span class="line">      <span class="attr">"operand"</span>: &#123;</span><br><span class="line">        <span class="attr">"directory"</span>: <span class="string">"sales"</span>,</span><br><span class="line">        <span class="attr">"flavor"</span>: <span class="string">"FILTERABLE"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œä¼šæå‡ºå‡ ä¸ªç–‘é—®ï¼š</p>
<ol>
<li>sqlå­—ç¬¦ä¸²ä¸­çš„â€™EMPSâ€™å­—ç¬¦ä¸²æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä»¥åŠå¦‚ä½•è½¬æ¢æˆå¯¹åº”çš„Tableçš„ï¼Ÿ</li>
<li>CsvSchemaFactoryåœ¨å…¶ä¸­å‚ä¸äº†ä»€ä¹ˆï¼Ÿä¸²è”äº†å“ªäº›è‡ªå®šä¹‰çš„ç»„ä»¶ï¼Ÿ</li>
</ol>
<p>å¸¦ç€ä»¥ä¸Šä¸¤ä¸ªç–‘é—®ï¼Œé€šè¿‡æ–­ç‚¹çš„æ–¹å¼ï¼Œå»æŸ¥çœ‹calciteä»£ç å®ç°ã€‚</p>
<blockquote>
<p>Tips: é™¤äº†debugï¼Œå¯ä»¥æµ‹è¯•ç”¨ä¾‹ä¸­æ•…æ„æ„é€ ä¸€äº› Caseï¼Œè§‚å¯Ÿå…¶å¼‚å¸¸æ ˆã€‚æ¯”å¦‚æ•…æ„æ„é€ ä¸å­˜åœ¨å­—æ®µï¼Œæ¥çœ‹validateæ˜¯å¦‚ä½•å®ç°çš„</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬ä¼šæ³¨æ„åˆ°<strong>ç¬¬ä¸€ä¸ªæ ¸å¿ƒç±»#æ–¹æ³•</strong>ï¼š</p>
<blockquote>
<p> <code>org.apache.calcite.jdbc.CalciteMetaImpl#prepareAndExecute</code></p>
</blockquote>
<p>é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹æ³•å®Œæˆäº†æ‰€æœ‰å‡†å¤‡é˜¶æ®µçš„å·¥ä½œä»¥åŠæœ€åçš„æ‰§è¡Œå·¥ä½œã€‚è¦äº†è§£æ•´ä¸ªå…·ä½“çš„æµç¨‹ç»†èŠ‚æ˜¯ä¸ç°å®çš„ï¼Œè¿™é‡Œæˆ‘æ ¹æ®è¾“å…¥ä»…ä»…ä¸ºmodelå’Œsqlï¼Œè€Œmodelæ˜¯ä¸ºäº†sqlæœåŠ¡çš„ï¼Œå†³å®šè·Ÿè¸ªsqlï¼ˆå…³ç³»ä»£æ•°ï¼‰åœ¨ä»£ç å†…çš„è¡¨ç¤ºå½¢å¼ï¼ˆæ•°æ®ç»“æ„ï¼‰ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•å˜åŒ–çš„ï¼Œä»è€Œè§£å†³ä»¥ä¸Šçš„ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<p>å‡†å¤‡é˜¶æ®µè¡¨è¾¾å…³ç³»ä»£æ•°çš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><p><code>org.apache.calcite.sql.SqlNode</code></p>
</li>
<li><p><code>org.apache.calcite.rel.RelNode</code></p>
</li>
</ul>
<p>æ‰§è¡Œé˜¶æ®µè¡¨è¾¾å…³ç³»ä»£æ•°çš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li><code>org.apache.calcite.interpreter.Node</code></li>
</ul>
<h1 id="ä»æ•°æ®ç»“æ„å˜åŒ–æ¥è®²è¿°å®ç°ç»†èŠ‚"><a href="#ä»æ•°æ®ç»“æ„å˜åŒ–æ¥è®²è¿°å®ç°ç»†èŠ‚" class="headerlink" title="ä»æ•°æ®ç»“æ„å˜åŒ–æ¥è®²è¿°å®ç°ç»†èŠ‚"></a>ä»æ•°æ®ç»“æ„å˜åŒ–æ¥è®²è¿°å®ç°ç»†èŠ‚</h1><h2 id="String-gt-SqlNode"><a href="#String-gt-SqlNode" class="headerlink" title="String -&gt; SqlNode:"></a>String -&gt; SqlNode:</h2><p>é€šè¿‡JavaCCè§£æSQLï¼Œè½¬åŒ–æˆASTå³SqlNode</p>
<h2 id="SqlNode-gt-RelNode"><a href="#SqlNode-gt-RelNode" class="headerlink" title="SqlNode -&gt; RelNode:"></a>SqlNode -&gt; RelNode:</h2><h3 id="validate-è¿›è¡ŒASTä¸­å„ä¸ªç»„æˆéƒ¨åˆ†çš„æ£€æŸ¥"><a href="#validate-è¿›è¡ŒASTä¸­å„ä¸ªç»„æˆéƒ¨åˆ†çš„æ£€æŸ¥" class="headerlink" title="validate: è¿›è¡ŒASTä¸­å„ä¸ªç»„æˆéƒ¨åˆ†çš„æ£€æŸ¥"></a>validate: è¿›è¡ŒASTä¸­å„ä¸ªç»„æˆéƒ¨åˆ†çš„æ£€æŸ¥</h3><h3 id="parseQuery-è¿›è¡ŒSqlNodeè½¬åŒ–æˆRelNode"><a href="#parseQuery-è¿›è¡ŒSqlNodeè½¬åŒ–æˆRelNode" class="headerlink" title="parseQuery: è¿›è¡ŒSqlNodeè½¬åŒ–æˆRelNode"></a>parseQuery: è¿›è¡ŒSqlNodeè½¬åŒ–æˆRelNode</h3><h2 id="RelNode-gt-RelNode"><a href="#RelNode-gt-RelNode" class="headerlink" title="RelNode -&gt; RelNode:"></a>RelNode -&gt; RelNode:</h2><h3 id="optimize-è¿›è¡ŒRelNodeçš„ç­‰ä»·è½¬æ¢ï¼Œæ‰¾åˆ°æœ€ä¼˜çš„plan"><a href="#optimize-è¿›è¡ŒRelNodeçš„ç­‰ä»·è½¬æ¢ï¼Œæ‰¾åˆ°æœ€ä¼˜çš„plan" class="headerlink" title="optimize: è¿›è¡ŒRelNodeçš„ç­‰ä»·è½¬æ¢ï¼Œæ‰¾åˆ°æœ€ä¼˜çš„plan"></a>optimize: è¿›è¡ŒRelNodeçš„ç­‰ä»·è½¬æ¢ï¼Œæ‰¾åˆ°æœ€ä¼˜çš„plan</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Optimizes a query plan.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> root Root of relational expression tree</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> materializations Tables known to be populated with a given query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lattices Lattices</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an equivalent optimized relational expression</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> RelRoot <span class="title">optimize</span><span class="params">(RelRoot root,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> List&lt;Materialization&gt; materializations,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> List&lt;CalciteSchema.LatticeEntry&gt; lattices)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> RelOptPlanner planner = root.rel.getCluster().getPlanner();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> DataContext dataContext = context.getDataContext();</span><br><span class="line">  planner.setExecutor(<span class="keyword">new</span> RexExecutorImpl(dataContext));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ­¤å¤„çœç•¥materializationå’Œlatticeç›¸å…³çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> RelTraitSet desiredTraits = getDesiredRootTraitSet(root);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> RelVisitor visitor = <span class="keyword">new</span> RelVisitor() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(RelNode node, <span class="keyword">int</span> ordinal, RelNode parent)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TableScan) &#123;</span><br><span class="line">        <span class="keyword">final</span> RelOptCluster cluster = node.getCluster();</span><br><span class="line">        <span class="keyword">final</span> RelOptTable.ToRelContext context =</span><br><span class="line">            ViewExpanders.simpleContext(cluster);</span><br><span class="line">        <span class="keyword">final</span> RelNode r = node.getTable().toRel(context);</span><br><span class="line">        planner.registerClass(r);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">super</span>.visit(node, ordinal, parent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  visitor.go(root.rel);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Program program = getProgram();</span><br><span class="line">  <span class="keyword">final</span> RelNode rootRel4 = program.run(</span><br><span class="line">      planner, root.rel, desiredTraits, materializationList, latticeList);</span><br><span class="line">  <span class="keyword">if</span> (LOGGER.isDebugEnabled()) &#123;</span><br><span class="line">    LOGGER.debug(<span class="string">"Plan after physical tweaks: &#123;&#125;"</span>,</span><br><span class="line">        RelOptUtil.toString(rootRel4, SqlExplainLevel.ALL_ATTRIBUTES));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> root.withRel(rootRel4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯optimizeçš„ä»£ç ï¼Œé€šè¿‡é˜…è¯»ï¼Œå‘ç°ä¸»è¦æ˜¯æ‰§è¡Œ<code>visitor.go</code>, <code>program.run</code>, <code>Root.withRel</code>ä¸‰ä¸ªæ–¹æ³•ï¼Œä¸‹é¢å¯¹è¿™ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«è¿›è¡Œåˆ†æ</p>
<h4 id="visitor-go"><a href="#visitor-go" class="headerlink" title="visitor.go"></a>visitor.go</h4><p>æ­¤å¤„çš„è®¿é—®è€…æ¨¡å¼ï¼Œåœ¨é‡å†™çš„visitæ–¹æ³•ä¸­<u>åˆ©ç”¨super.visitè®¿é—®å­å…ƒç´ è¿›è¡Œæ ‘çš„éå†</u>ã€‚ä¸‹é¢æ˜¯super.visitä»¥åŠRelNodeçš„acceptæ–¹æ³•ã€‚</p>
<blockquote>
<p>åœ¨ä¹‹åä¼šæåˆ°çš„HepPlannerå’ŒHepInstructionä¹‹é—´ä¹Ÿæœ‰ä¸€æ ·çš„visitoræ¨¡å¼ï¼ŒInstructionæ˜¯è¢«è®¿é—®è€…ï¼Œæœ€åè¿˜æ˜¯åœ¨plannerä¸­å®šåˆ¶å®é™…çš„æ“ä½œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Visits a node during a traversal.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node    Node to visit</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordinal Ordinal of node within its parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parent  Parent of the node, or null if it is the root of the</span></span><br><span class="line"><span class="comment"> *                traversal</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    RelNode node,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> ordinal,</span></span></span><br><span class="line"><span class="function"><span class="params">    RelNode parent)</span> </span>&#123;</span><br><span class="line">  node.childrenAccept(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">childrenAccept</span><span class="params">(RelVisitor visitor)</span> </span>&#123;</span><br><span class="line">  visitor.visit(input, <span class="number">0</span>, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œéå†æ˜¯ä¸ºäº†æ‰¾TableScanå…ƒç´ ï¼Œç„¶åæ³¨å†Œå¯¹åº”çš„RelNodeï¼Œ<u><em>ä¸è¿‡ä¸æ¸…æ¥šè¿™è¾¹ä¸ºå•¥è¦é‡æ–°toRelç”Ÿæˆï¼Ÿdebugäº†ä¸‹å¹¶æ²¡æœ‰å˜åŒ–ï¼Œè€Œä¸”è¿˜å°‘äº†rowTypeçš„ä¿¡æ¯</em></u>ã€‚ä¸‹é¢æ˜¯registerçš„é€»è¾‘ï¼Œä¸»è¦æ˜¯æœ‰æ–°çš„RelNodeä¹‹åï¼Œ<strong>è¿›è¡Œç›¸å…³classçš„æ³¨å†Œä»¥åŠè§„åˆ™çš„æ·»åŠ åˆ°plannerä¸­</strong>ã€‚</p>
<blockquote>
<p>Qï¼šä¸ºä»€ä¹ˆé€‰æ‹©TableScanç±»å‹çš„Nodeæ¥registerå…¶è§„åˆ™å‘¢ï¼Ÿ</p>
<p>Aï¼šå› ä¸ºTableScanä»£è¡¨æœ€åº•å±‚çš„æ•°æ®æºï¼Œå› æ­¤å…³äºæ­¤æ•°æ®æºçš„è§„åˆ™éƒ½ç»Ÿä¸€åœ¨æ­¤æ³¨å†Œæ˜¯æœ€è‡ªç„¶çš„ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerClass</span><span class="params">(RelNode node)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Class&lt;? extends RelNode&gt; clazz = node.getClass();</span><br><span class="line">  <span class="keyword">if</span> (classes.add(clazz)) &#123;</span><br><span class="line">    onNewClass(node); <span class="comment">//  è°ƒç”¨nodeçš„registeræ–¹æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (RelTrait trait : node.getTraitSet()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (traits.add(trait)) &#123;</span><br><span class="line">      trait.register(<span class="keyword">this</span>); <span class="comment">// è°ƒç”¨traitçš„registeræ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="program-run"><a href="#program-run" class="headerlink" title="program.run"></a>program.run</h4><p>è§‚å¯Ÿè¯¥æ–¹æ³•çš„å‚æ•°ä»¥åŠè°ƒç”¨è€…ï¼Œé¦–å…ˆå¾—çŸ¥é“<strong>planner, desiredTraits, programï¼Œ</strong>çš„å®šä¹‰ä»¥åŠå¦‚ä½•ç”Ÿæˆæ‰èƒ½è¿›ä¸€æ­¥äº†è§£è¯¥æ–¹æ³•åˆ©ç”¨è¿™äº›å‚æ•°åšäº†ä»€ä¹ˆã€‚materializationList, latticeListå’Œç‰©åŒ–å’Œé¢„è®¡ç®—ç›¸å…³çš„å…ˆä¸å»ç®¡å®ƒï¼Œå…ˆçœ‹ä¸»è¦é€»è¾‘ã€‚</p>
<h5 id="Planner"><a href="#Planner" class="headerlink" title="Planner"></a>Planner</h5><h6 id="MockRelOptPlanner"><a href="#MockRelOptPlanner" class="headerlink" title="MockRelOptPlanner"></a>MockRelOptPlanner</h6><p>åœ¨é˜…è¯»ä¸‹é¢å…³äºVolcanoPlannerç›¸å…³çš„å†…å®¹ä¹‹å‰ï¼Œè¿™é‡Œå¼ºçƒˆå»ºè®®å…ˆçœ‹ä¸€ä¸‹<code>org.apache.calcite.test.MockRelOptPlanner</code>è¿™ä¸ªmockç±»ï¼Œäº†è§£ä¸€ä¸‹å®ç°ä¸€ä¸ªplannerçš„ä¸»è¦æ¥å£ä»¥åŠåŸºç¡€å®ç°ï¼Œæ¯”å¦‚ï¼šfindBestExpï¼ŒmatchRecursive, matchç­‰ç­‰æ–¹æ³•çš„å®ç°ï¼Œä¼šå‘ç°ä¼˜åŒ–å™¨çš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<ol>
<li><code>match</code>ï¼šæ˜¯å¦relational expressionå’Œruleçš„operandsåŒ¹é… </li>
<li><code>rule.match(RelOptRuleCall call)</code>ï¼šè™½ç„¶matchï¼Œä½†æ˜¯plannerç§¯æ”’äº†ä¸€äº›RelOptRuleCallï¼Œå¯ä»¥æå‰å‰ªæ</li>
<li><code>rule.onmatch(RelOptRuleCall call)</code>ï¼šæ ¹æ®<code>call.rels</code>ç”Ÿæˆæ–°çš„expressionï¼Œé€šè¿‡å›è°ƒ<code>RelOptRuleCall.transformTo</code>æ³¨å†Œæ–°çš„expression</li>
<li>å¦‚æœåŒ¹é…å®Œæˆï¼Œæ›¿æ¢rootæˆ–è€…parentçš„input</li>
<li>å¦åˆ™ç»§ç»­åŒ¹é…å­å…ƒç´ </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Recursively matches a rule.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rel             Relational expression</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parent          Parent relational expression</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ordinalInParent Ordinal of relational expression among its</span></span><br><span class="line"><span class="comment"> *                        siblings</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> whether match occurred</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">matchRecursive</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    RelNode rel,</span></span></span><br><span class="line"><span class="function"><span class="params">    RelNode parent,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> ordinalInParent)</span> </span>&#123;</span><br><span class="line">  List&lt;RelNode&gt; bindings = <span class="keyword">new</span> ArrayList&lt;RelNode&gt;();</span><br><span class="line">  <span class="keyword">if</span> (match(</span><br><span class="line">      rule.getOperand(),</span><br><span class="line">      rel,</span><br><span class="line">      bindings)) &#123;</span><br><span class="line">    MockRuleCall call =</span><br><span class="line">        <span class="keyword">new</span> MockRuleCall(</span><br><span class="line">            <span class="keyword">this</span>,</span><br><span class="line">            rule.getOperand(),</span><br><span class="line">            bindings.toArray(<span class="keyword">new</span> RelNode[<span class="number">0</span>]));</span><br><span class="line">    <span class="keyword">if</span> (rule.matches(call)) &#123;</span><br><span class="line">      rule.onMatch(call);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (transformationResult != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">      root = transformationResult;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      parent.replaceInput(ordinalInParent, transformationResult);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  List&lt;? extends RelNode&gt; children = rel.getInputs();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; children.size(); ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (matchRecursive(children.get(i), rel, i)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="VolcanoPlanner"><a href="#VolcanoPlanner" class="headerlink" title="VolcanoPlanner"></a>VolcanoPlanner</h6><p>ä¸‹é¢å›åˆ°æ­£é¢˜ï¼Œæ¥çœ‹ä¸‹VolcanoPlannerç›¸å…³çš„å®šä¹‰å’Œç”Ÿæˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a uninitialized &lt;code&gt;VolcanoPlanner&lt;/code&gt;. To fully initialize</span></span><br><span class="line"><span class="comment"> * it, the caller must register the desired set of relations, rules, and</span></span><br><span class="line"><span class="comment"> * calling conventions.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">VolcanoPlanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Creates a query planner and initializes it with a default set of</span></span><br><span class="line"><span class="comment"> * rules. */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> RelOptPlanner <span class="title">createPlanner</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">final</span> CalcitePrepare.Context prepareContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    org.apache.calcite.plan.Context externalContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    RelOptCostFactory costFactory)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (externalContext == <span class="keyword">null</span>) &#123;</span><br><span class="line">    externalContext = Contexts.of(prepareContext.config());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> VolcanoPlanner planner =</span><br><span class="line">      <span class="keyword">new</span> VolcanoPlanner(costFactory, externalContext);</span><br><span class="line">  planner.addRelTraitDef(ConventionTraitDef.INSTANCE);</span><br><span class="line">  <span class="keyword">if</span> (CalciteSystemProperty.ENABLE_COLLATION_TRAIT.value()) &#123;</span><br><span class="line">    planner.addRelTraitDef(RelCollationTraitDef.INSTANCE);</span><br><span class="line">  &#125;</span><br><span class="line">  RelOptUtil.registerDefaultRules(planner,</span><br><span class="line">      prepareContext.config().materializationsEnabled(),</span><br><span class="line">      enableBindable);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> CalcitePrepare.SparkHandler spark = prepareContext.spark();</span><br><span class="line">  <span class="keyword">if</span> (spark.enabled()) &#123;</span><br><span class="line">    spark.registerRules(</span><br><span class="line">        <span class="keyword">new</span> SparkHandler.RuleSetBuilder() &#123;</span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRule</span><span class="params">(RelOptRule rule)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeRule</span><span class="params">(RelOptRule rule)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  Hook.PLANNER.run(planner); <span class="comment">// allow test to add or remove rules</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> planner;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>plannerçš„åˆå§‹åŒ–ï¼Œæ ¹æ®<u>å®šä¹‰çš„æ³¨é‡Šå†…å®¹</u>ä¸»è¦éœ€è¦å¡«å……ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>è§„åˆ™</li>
<li>å…³æ³¨çš„ç‰¹å¾ç±»åˆ«</li>
<li>å…³ç³»è¡¨è¾¾å¼</li>
</ol>
<p>ä¸Šé¢çš„<code>createPlanner</code>ä»£ç ä¹Ÿå°è¯äº†è¿™ä¸€ç‚¹ï¼Œä¸‹é¢æ¥çœ‹ä¸‹æ¯ä¸€ä¸ªå¡«å……å…·ä½“åšäº†ä»€ä¹ˆã€‚</p>
<p>######- addRule</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addRule</span><span class="params">(RelOptRule rule)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ruleSet.contains(rule)) &#123;</span><br><span class="line">    <span class="comment">// Rule already exists.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">boolean</span> added = ruleSet.add(rule);</span><br><span class="line">  <span class="keyword">assert</span> added;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> String ruleName = rule.toString();</span><br><span class="line">  <span class="keyword">if</span> (ruleNames.put(ruleName, rule.getClass())) &#123;</span><br><span class="line">    Set&lt;Class&gt; x = ruleNames.get(ruleName);</span><br><span class="line">    <span class="keyword">if</span> (x.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Rule description '"</span> + ruleName</span><br><span class="line">          + <span class="string">"' is not unique; classes: "</span> + x);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapRuleDescription(rule);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Each of this rule's operands is an 'entry point' for a rule call.</span></span><br><span class="line">  <span class="comment">// Register each operand against all concrete sub-classes that could match</span></span><br><span class="line">  <span class="comment">// it.</span></span><br><span class="line">  <span class="keyword">for</span> (RelOptRuleOperand operand : rule.getOperands()) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;? extends RelNode&gt; subClass</span><br><span class="line">        : subClasses(operand.getMatchedClass())) &#123;</span><br><span class="line">      classOperands.put(subClass, operand);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If this is a converter rule, check that it operates on one of the</span></span><br><span class="line">  <span class="comment">// kinds of trait we are interested in, and if so, register the rule</span></span><br><span class="line">  <span class="comment">// with the trait.</span></span><br><span class="line">  <span class="keyword">if</span> (rule <span class="keyword">instanceof</span> ConverterRule) &#123;</span><br><span class="line">    ConverterRule converterRule = (ConverterRule) rule;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> RelTrait ruleTrait = converterRule.getInTrait();</span><br><span class="line">    <span class="keyword">final</span> RelTraitDef ruleTraitDef = ruleTrait.getTraitDef();</span><br><span class="line">    <span class="keyword">if</span> (traitDefs.contains(ruleTraitDef)) &#123;</span><br><span class="line">      ruleTraitDef.registerConverterRule(<span class="keyword">this</span>, converterRule);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåœ¨æ·»åŠ è§„åˆ™æ—¶ï¼Œæœ€åä¼šæŠŠ<strong>conventionä¹‹é—´çš„è½¬æ¢å…³ç³»</strong>æ³¨å†Œåˆ°å¯¹åº”çš„RelTraitDefï¼ˆConventionTraitDefï¼‰ä¸­ã€‚</p>
<h6 id="setRoot"><a href="#setRoot" class="headerlink" title="- setRoot"></a>- setRoot</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoot</span><span class="params">(RelNode rel)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// We're registered all the rules, and therefore RelNode classes,</span></span><br><span class="line">  <span class="comment">// we're interested in, and have not yet started calling metadata providers.</span></span><br><span class="line">  <span class="comment">// So now is a good time to tell the metadata layer what to expect.</span></span><br><span class="line">  registerMetadataRels();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.root = registerImpl(rel, <span class="keyword">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.originalRoot == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.originalRoot = rel;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Making a node the root changes its importance.</span></span><br><span class="line">  <span class="keyword">this</span>.ruleQueue.recompute(<span class="keyword">this</span>.root);</span><br><span class="line">  ensureRootConverters();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>registerImplï¼š<ul>
<li>ä»æ ¹èŠ‚ç‚¹é€’å½’æ³¨å†Œæ‰€æœ‰èŠ‚ç‚¹åˆ°Set, SubSetä¸­</li>
<li>æ³¨å†Œè§„åˆ™åˆ°ä¼˜åŒ–å™¨</li>
<li>è®¡ç®—RelNodeå¯¹åº” RelSubsetçš„importanceï¼Œä¸ºé€‰æ‹©Ruleæä¾›æ”¯æŒ</li>
<li>è®°å½•åŒ¹é…çš„Ruleï¼Œç›´æ¥æ‰§è¡Œæˆ–è€…æ·»åŠ åˆ°ruleQueueé‡Œ</li>
</ul>
</li>
</ul>
<h6 id="changeTraits"><a href="#changeTraits" class="headerlink" title="- changeTraits"></a>- changeTraits</h6><p>###### </p>
<h5 id="desiredTraits"><a href="#desiredTraits" class="headerlink" title="desiredTraits"></a>desiredTraits</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> RelTraitSet <span class="title">getDesiredRootTraitSet</span><span class="params">(RelRoot root)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Make sure non-CallingConvention traits, if any, are preserved</span></span><br><span class="line">  <span class="keyword">return</span> root.rel.getTraitSet()</span><br><span class="line">      .replace(resultConvention)</span><br><span class="line">      .replace(root.collation)</span><br><span class="line">      .simplify();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœŸæœ›çš„è¾“å‡ºçš„ç‰¹å¾ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªåœ¨plannerä¸­æ·»åŠ å…³æ³¨çš„ç‰¹å¾çš„å…·ä½“å®ç°: Convention &amp;&amp; Collationï¼Œè¿™ä¸¤è€…åœ¨ä¼˜åŒ–æ—¶å±äºå…³ç³»è¡¨è¾¾å¼çš„<strong>è¡¥å……ä¿¡æ¯</strong>ï¼Œåœ¨ä¼˜åŒ–æ—¶ä¼šä¸ä»…ä¼šè€ƒè™‘costï¼Œä¹Ÿä¼šç»“åˆè¡¥å……ä¿¡æ¯ï¼Œæ¯”å¦‚æ’åºä»¥åŠè°ƒç”¨çº¦å®šã€‚</p>
<h5 id="Program"><a href="#Program" class="headerlink" title="Program"></a>Program</h5><p>é¦–å…ˆéœ€è¦çœ‹ä¸‹Programçš„å®šä¹‰å’Œç”Ÿæˆ</p>
<blockquote>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;   <span class="comment">/**</span></span><br><span class="line"><span class="comment">&gt;    * Program that transforms a relational expression into another relational</span></span><br><span class="line"><span class="comment">&gt;    * expression.</span></span><br><span class="line"><span class="comment">&gt;    *</span></span><br><span class="line"><span class="comment">&gt;    * &lt;p&gt;A planner is a sequence of programs, each of which is sometimes called</span></span><br><span class="line"><span class="comment">&gt;    * a "phase".</span></span><br><span class="line"><span class="comment">&gt;    * The most tyÃŸpical program is an invocation of the volcano planner with a</span></span><br><span class="line"><span class="comment">&gt;    * particular &#123;<span class="doctag">@link</span> org.apache.calcite.tools.RuleSet&#125;.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">&gt;    */</span></span><br><span class="line">&gt;   <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Program</span> </span>&#123;</span><br><span class="line">&gt;     <span class="function">RelNode <span class="title">run</span><span class="params">(RelOptPlanner planner, RelNode rel,</span></span></span><br><span class="line"><span class="function"><span class="params">&gt;         RelTraitSet requiredOutputTraits,</span></span></span><br><span class="line"><span class="function"><span class="params">&gt;         List&lt;RelOptMaterialization&gt; materializations,</span></span></span><br><span class="line"><span class="function"><span class="params">&gt;         List&lt;RelOptLattice&gt; lattices)</span></span>;</span><br><span class="line">&gt;   &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Programçš„å®šä¹‰å¯çŸ¥ï¼Œ<strong>program</strong>æ˜¯è´Ÿè´£è½¬æ¢<strong>å…³ç³»è¡¨è¾¾å¼</strong>çš„ï¼Œè€Œ<strong>planner</strong>å°±æ˜¯ç”±å¤šä¸ªprogram <strong>sequence</strong>ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªprogramå¯ä»¥å«åšä¸€ä¸ª<strong>phase</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Program <span class="title">getProgram</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Allow a test to override the default program.</span></span><br><span class="line">  <span class="keyword">final</span> Holder&lt;Program&gt; holder = Holder.of(<span class="keyword">null</span>);</span><br><span class="line">  Hook.PROGRAM.run(holder); <span class="comment">// è¿è¡Œé’©å­</span></span><br><span class="line">  <span class="keyword">if</span> (holder.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> holder.get();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Programs.standard();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹<strong>Holder</strong>å’Œ<strong>Hook</strong>çš„ä½œç”¨ï¼ŒHolderå¯ä»¥ä¿å­˜å¯¹è±¡ï¼Œç”¨æ¥å®ç°å‚æ•°çš„ä¼ é€’ï¼›Hookåˆ™æ˜¯åœ¨query prepareè¿‡ç¨‹ä¸­ä¸åŒé˜¶æ®µçš„é’©å­ï¼Œæ˜¯enumç±»å‹çš„ï¼Œå¯ä»¥æ·»åŠ Consumeræ–¹æ³•æ¥æ·»åŠ ä¸€äº›æµ‹è¯•æˆ–è€…debugé€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬çš„ä¾‹å­é‡Œè¿™ä¸¤ä¸ªæ²¡æœ‰å½±å“ï¼Œæ‰€éœ€è¦çœ‹çš„å°±æ˜¯<code>Programs.standard()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Returns the standard program with user metadata provider. */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Program <span class="title">standard</span><span class="params">(RelMetadataProvider metadataProvider)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Program program1 =</span><br><span class="line">      (planner, rel, requiredOutputTraits, materializations, lattices) -&gt; &#123;</span><br><span class="line">        planner.setRoot(rel);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (RelOptMaterialization materialization : materializations) &#123;</span><br><span class="line">          planner.addMaterialization(materialization);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (RelOptLattice lattice : lattices) &#123;</span><br><span class="line">          planner.addLattice(lattice);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> RelNode rootRel2 =</span><br><span class="line">            rel.getTraitSet().equals(requiredOutputTraits)</span><br><span class="line">                ? rel</span><br><span class="line">                : planner.changeTraits(rel, requiredOutputTraits);</span><br><span class="line">        <span class="keyword">assert</span> rootRel2 != <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        planner.setRoot(rootRel2);</span><br><span class="line">        <span class="keyword">final</span> RelOptPlanner planner2 = planner.chooseDelegate();</span><br><span class="line">        <span class="keyword">final</span> RelNode rootRel3 = planner2.findBestExp();</span><br><span class="line">        <span class="keyword">assert</span> rootRel3 != <span class="keyword">null</span> : <span class="string">"could not implement exp"</span>;</span><br><span class="line">        <span class="keyword">return</span> rootRel3;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sequence(subQuery(metadataProvider),</span><br><span class="line">      <span class="keyword">new</span> DecorrelateProgram(),</span><br><span class="line">      <span class="keyword">new</span> TrimFieldsProgram(),</span><br><span class="line">      program1,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Second planner pass to do physical "tweaks". This the first time</span></span><br><span class="line">      <span class="comment">// that EnumerableCalcRel is introduced.</span></span><br><span class="line">      calc(metadataProvider));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ˜¯è¿”å›äº†ä¸€ä¸ªsequenceé‡Œé¢åŒ…å«äº†äº”ä¸ªä¸åŒçš„programä½œä¸ºæœ€ç»ˆçš„programã€‚å…¶ä¸­æœ€é‡è¦çš„åˆ™æ˜¯åœ¨<code>standard</code>æ–¹æ³•ä¸­å®šä¹‰çš„program1ï¼Œå®Œæˆäº†ä¸»è¦çš„ä¼˜åŒ–å·¥ä½œã€‚ä¸‹é¢å°±ç€é‡çœ‹ä¸‹program1å…·ä½“åšäº†ä»€ä¹ˆã€‚</p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯åœ¨æ“ä½œplannerï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><code>planner.setRoot</code></li>
<li><code>planner.changeTraits</code></li>
<li><code>planner.findBestExp</code></li>
</ol>
<p>å…¶ä¸­1, 2 åœ¨å‰é¢ä»‹ç»VolcanoPlannerå®šä¹‰å’Œç”Ÿæˆéƒ¨åˆ†å°±è®²è¿‡äº†ï¼Œè¿™é‡Œä¸»è¦è®²ä¸‹<code>planner.findBestExp</code>çš„è¿è¡ŒåŸç†ã€‚</p>
<h6 id="findBestExp"><a href="#findBestExp" class="headerlink" title="findBestExp"></a>findBestExp</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RelNode <span class="title">findBestExp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ensureRootConverters(); <span class="comment">// ç¡®ä¿æ ¹èŠ‚ç‚¹SubSetä¹‹é—´ç”±è¯¥Setä¸‹çš„å…¶ä»–SubSet convertå¾—åˆ°</span></span><br><span class="line">  registerMaterializations();<span class="comment">// æ³¨å†Œç‰©åŒ–ç›¸å…³çš„RelNode</span></span><br><span class="line">  <span class="keyword">int</span> cumulativeTicks = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (VolcanoPlannerPhase phase : VolcanoPlannerPhase.values()) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    	åˆå§‹åŒ–SubSetçš„Importance,è¿›è€Œæ›´æ–°RuleMatchçš„Importance</span></span><br><span class="line"><span class="comment">    	Double importance = Math.pow(0.9, (double) depth);</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    setInitialImportance();</span><br><span class="line">    RelOptCost targetCost = costFactory.makeHugeCost();</span><br><span class="line">    <span class="keyword">int</span> tick = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> firstFiniteTick = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> splitCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> giveUpTick = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      ++tick;</span><br><span class="line">      ++cumulativeTicks;</span><br><span class="line">      <span class="keyword">if</span> (root.bestCost.isLe(targetCost)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (firstFiniteTick &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          firstFiniteTick = cumulativeTicks;</span><br><span class="line"></span><br><span class="line">          clearImportanceBoost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ambitious) &#123;</span><br><span class="line">          <span class="comment">// Choose a slightly more ambitious target cost, and</span></span><br><span class="line">          <span class="comment">// try again. If it took us 1000 iterations to find our</span></span><br><span class="line">          <span class="comment">// first finite plan, give ourselves another 100</span></span><br><span class="line">          <span class="comment">// iterations to reduce the cost by 10%.</span></span><br><span class="line">          targetCost = root.bestCost.multiplyBy(<span class="number">0.9</span>);</span><br><span class="line">          ++splitCount;</span><br><span class="line">          <span class="keyword">if</span> (impatient) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstFiniteTick &lt; <span class="number">10</span>) &#123;</span><br><span class="line">              <span class="comment">// It's possible pre-processing can create</span></span><br><span class="line">              <span class="comment">// an implementable plan -- give us some time</span></span><br><span class="line">              <span class="comment">// to actually optimize it.</span></span><br><span class="line">              giveUpTick = cumulativeTicks + <span class="number">25</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              giveUpTick =</span><br><span class="line">                  cumulativeTicks</span><br><span class="line">                      + Math.max(firstFiniteTick / <span class="number">10</span>, <span class="number">25</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cumulativeTicks &gt; giveUpTick) &#123;</span><br><span class="line">        <span class="comment">// We haven't made progress recently. Take the current best.</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root.bestCost.isInfinite() &amp;&amp; ((tick % <span class="number">10</span>) == <span class="number">0</span>)) &#123;</span><br><span class="line">        injectImportanceBoost();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      LOGGER.debug(<span class="string">"PLANNER = &#123;&#125;; TICK = &#123;&#125;/&#123;&#125;; PHASE = &#123;&#125;; COST = &#123;&#125;"</span>,</span><br><span class="line">          <span class="keyword">this</span>, cumulativeTicks, tick, phase.toString(), root.bestCost);</span><br><span class="line"></span><br><span class="line">      VolcanoRuleMatch match = ruleQueue.popMatch(phase);</span><br><span class="line">      <span class="keyword">if</span> (match == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">assert</span> match.getRule().matches(match);</span><br><span class="line">      match.onMatch();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// The root may have been merged with another</span></span><br><span class="line">      <span class="comment">// subset. Find the new root subset.</span></span><br><span class="line">      root = canonize(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ruleQueue.phaseCompleted(phase);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (LOGGER.isTraceEnabled()) &#123;</span><br><span class="line">    StringWriter sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line">    <span class="keyword">final</span> PrintWriter pw = <span class="keyword">new</span> PrintWriter(sw);</span><br><span class="line">    dump(pw);</span><br><span class="line">    pw.flush();</span><br><span class="line">    LOGGER.trace(sw.toString());</span><br><span class="line">  &#125;</span><br><span class="line">  RelNode cheapest = root.buildCheapestPlan(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (LOGGER.isDebugEnabled()) &#123;</span><br><span class="line">    LOGGER.debug(</span><br><span class="line">        <span class="string">"Cheapest plan:\n&#123;&#125;"</span>, RelOptUtil.toString(cheapest, SqlExplainLevel.ALL_ATTRIBUTES));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!provenanceMap.isEmpty()) &#123;</span><br><span class="line">      LOGGER.debug(<span class="string">"Provenance:\n&#123;&#125;"</span>, provenance(cheapest));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cheapest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æˆ‘ç»™äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>å¡«å……æ ¹èŠ‚ç‚¹AbstractConverter(if needed)</p>
</li>
<li><p>æ³¨å†Œç‰©åŒ–çš„RelNode</p>
</li>
<li><p>åœ¨ä¸åŒçš„phaseä¸‹</p>
<ol>
<li><p>åˆå§‹åŒ–Importance</p>
</li>
<li><p>è¿›å…¥è¿­ä»£VolcanoRuleMatch</p>
<ol>
<li><p>åˆ¤æ–­æ˜¯å¦é€€å‡º</p>
<ol>
<li><p>ruleMatchä¸ºç©ºäº†</p>
</li>
<li><p>For ambitious planners:  è¿‘æœŸæ²¡æœ‰æå‡</p>
<p>è¿‘æœŸçš„è¿­ä»£æ¬¡æ•°æ˜¯æŒ‡ï¼š (specifically within a number of iterations that is 10% of the number of iterations necessary to first reach an implementable plan or 25 iterations whichever is larger).</p>
<p>æå‡æ˜¯æŒ‡ï¼šä½äºä¹‹å‰æœ€ä¼˜costçš„90%</p>
</li>
<li><p>For non-ambitious planners: æ‰¾åˆ°ä¸€ä¸ªImplement plan</p>
<blockquote>
<p>Furthermore, after every 10 iterations without an implementable plan, RelSubSets that contain only logical RelNodes are given an importance boost via injectImportanceBoost(). Once an implementable plan is found, the artificially raised importance values are cleared (see clearImportanceBoost()).</p>
</blockquote>
</li>
</ol>
</li>
<li><p>åŒ¹é…è§„åˆ™</p>
<p>// todo</p>
</li>
<li><p>canonizeæ ¹èŠ‚ç‚¹</p>
</li>
</ol>
</li>
</ol>
</li>
<li><p>root.buildCheapestPlan</p>
</li>
</ol>
<h4 id="Root-withRel"><a href="#Root-withRel" class="headerlink" title="Root.withRel"></a>Root.withRel</h4><h4 id="optimize-summary"><a href="#optimize-summary" class="headerlink" title="optimize summary:"></a>optimize summary:</h4><p>æœ¬è´¨ä¸Šï¼Œä¼˜åŒ–åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å¡«å……planner<ul>
<li>createPlanner: åˆå§‹åŒ–plannerï¼Œå¡«å……é»˜è®¤è§„åˆ™ä»¥åŠtraitDef</li>
<li>visitor.go: å¡«å……æ•°æ®æºç›¸å…³çš„rule</li>
<li>setRoot: <ul>
<li>å°†RelNodeè½¬åŒ–æˆRelSubSet</li>
<li>åŒ¹é…è§„åˆ™</li>
</ul>
</li>
<li>changeTraits: </li>
</ul>
</li>
<li>æ‰§è¡ŒfindBestExp</li>
</ol>
<h2 id="RelNode-gt-Bindable"><a href="#RelNode-gt-Bindable" class="headerlink" title="RelNode -&gt; Bindable:"></a>RelNode -&gt; Bindable:</h2><ul>
<li><p><code>Bindable</code></p>
<p>æœ€ç»ˆè¿”å›çš„å¯¹è±¡ï¼›å¯ä»¥å’ŒContextç»‘å®šåè¿”å›Enumerable over rowsï¼›</p>
</li>
<li><p><code>EnumerableInterpretable</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bindable = EnumerableInterpretable.toBindable(internalParameters,</span><br><span class="line">              context.spark(), enumerable, prefer);</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œä¸»è¦ç”¨<a href="https://github.com/apache/calcite/blob/e226ae49f987dde3a64b69cd474152d9adc7c38c/core/src/main/java/org/apache/calcite/adapter/enumerable/EnumerableInterpretable.java#L105" target="_blank" rel="noopener">toBindable</a>æ–¹æ³•æ¥è¿”å›<code>Bindable</code>å¯¹è±¡çš„</p>
<p>è€Œ<code>toBindable</code>æ–¹æ³•ä¸­æœ€é‡è¦çš„æ˜¯é€šè¿‡<code>EnumerableRelImplementor</code>å¯¹è±¡çš„<a href="https://github.com/apache/calcite/blob/b8bdfb074be12f90c98f9f1fa2af8cf46f2d36f1/core/src/main/java/org/apache/calcite/adapter/enumerable/EnumerableRelImplementor.java#L102" target="_blank" rel="noopener">implementRoot</a>æ–¹æ³•ç”Ÿæˆ<code>ClassDeclaration</code></p>
<p>è¿›è€Œé€šè¿‡<a href="https://github.com/apache/calcite/blob/e226ae49f987dde3a64b69cd474152d9adc7c38c/core/src/main/java/org/apache/calcite/adapter/enumerable/EnumerableInterpretable.java#L133" target="_blank" rel="noopener">getBindable</a>æ–¹æ³•åˆ©ç”¨janinoç”ŸæˆBindableå®ä¾‹ï¼›</p>
</li>
<li><p><code>RelImplementor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ClassDeclaration expr = relImplementor.implementRoot(rel, prefer);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  This is a marker interface for a callback used to <strong>convert a tree of relational expressions into a plan</strong>. <u>Calling conventions typically have their own protocol for walking over a tree, and correspondingly have their own implementors</u></p>
<p>  å› ä¸ºæ ¹èŠ‚ç‚¹é»˜è®¤æ˜¯Enumerable Conventionï¼Œå› æ­¤å¿…ç„¶ä¼šç»å†<code>EnumerableRelImplementor</code>ï¼Œè€Œåœ¨æµ‹è¯•ä¸­ï¼Œç”±äºä½¿ç”¨äº†jdbc.clickhouseï¼Œå› æ­¤è¿˜ä¼šç”¨åˆ°<code>JdbcImplementor</code></p>
<ul>
<li><p>â€”&gt;<code>EnumerableRelImplementor</code>ï¼šSubclass of org.apache.calcite.plan.RelImplementor for relational operators of <u>EnumerableConvention calling convention</u>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ClassDeclaration <span class="title">implementRoot</span><span class="params">(EnumerableRel rootRel,</span></span></span><br><span class="line"><span class="function"><span class="params">    EnumerableRel.Prefer prefer)</span> </span>&#123;</span><br><span class="line">  EnumerableRel.Result result = rootRel.implement(<span class="keyword">this</span>, prefer);</span><br><span class="line">  <span class="keyword">switch</span> (prefer) &#123;</span><br><span class="line">  <span class="keyword">case</span> ARRAY:</span><br><span class="line">    <span class="keyword">if</span> (result.physType.getFormat() == JavaRowFormat.ARRAY</span><br><span class="line">        &amp;&amp; rootRel.getRowType().getFieldCount() == <span class="number">1</span>) &#123;</span><br><span class="line">      BlockBuilder bb = <span class="keyword">new</span> BlockBuilder();</span><br><span class="line">      Expression e = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">for</span> (Statement statement : result.block.statements) &#123;</span><br><span class="line">        <span class="keyword">if</span> (statement <span class="keyword">instanceof</span> GotoStatement) &#123;</span><br><span class="line">          e = bb.append(<span class="string">"v"</span>, ((GotoStatement) statement).expression);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          bb.add(statement);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">        bb.add(</span><br><span class="line">            Expressions.return_(<span class="keyword">null</span>,</span><br><span class="line">                Expressions.call(<span class="keyword">null</span>, BuiltInMethod.SLICE0.method, e)));</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="keyword">new</span> EnumerableRel.Result(bb.toBlock(), result.physType,</span><br><span class="line">          JavaRowFormat.SCALAR);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> List&lt;MemberDeclaration&gt; memberDeclarations = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="keyword">new</span> TypeRegistrar(memberDeclarations).go(result);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This creates the following code</span></span><br><span class="line">  <span class="comment">// final Integer v1stashed = (Integer) root.get("v1stashed")</span></span><br><span class="line">  <span class="comment">// It is convenient for passing non-literal "compile-time" constants</span></span><br><span class="line">  <span class="keyword">final</span> Collection&lt;Statement&gt; stashed =</span><br><span class="line">      Collections2.transform(stashedParameters.values(),</span><br><span class="line">          input -&gt; Expressions.declare(Modifier.FINAL, input,</span><br><span class="line">              Expressions.convert_(</span><br><span class="line">                  Expressions.call(DataContext.ROOT,</span><br><span class="line">                      BuiltInMethod.DATA_CONTEXT_GET.method,</span><br><span class="line">                      Expressions.constant(input.name)),</span><br><span class="line">                  input.type)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> BlockStatement block = Expressions.block(</span><br><span class="line">      Iterables.concat(</span><br><span class="line">          stashed,</span><br><span class="line">          result.block.statements));</span><br><span class="line">  memberDeclarations.add(</span><br><span class="line">      Expressions.methodDecl(</span><br><span class="line">          Modifier.PUBLIC,</span><br><span class="line">          Enumerable.class,</span><br><span class="line">          BuiltInMethod.BINDABLE_BIND.method.getName(),</span><br><span class="line">          Expressions.list(DataContext.ROOT),</span><br><span class="line">          block));</span><br><span class="line">  memberDeclarations.add(</span><br><span class="line">      Expressions.methodDecl(Modifier.PUBLIC, Class.class,</span><br><span class="line">          BuiltInMethod.TYPED_GET_ELEMENT_TYPE.method.getName(),</span><br><span class="line">          ImmutableList.of(),</span><br><span class="line">          Blocks.toFunctionBlock(</span><br><span class="line">              Expressions.return_(<span class="keyword">null</span>,</span><br><span class="line">                  Expressions.constant(result.physType.getJavaRowType())))));</span><br><span class="line">  <span class="keyword">return</span> Expressions.classDecl(Modifier.PUBLIC,</span><br><span class="line">      <span class="string">"Baz"</span>,</span><br><span class="line">      <span class="keyword">null</span>,</span><br><span class="line">      Collections.singletonList(Bindable.class),</span><br><span class="line">      memberDeclarations);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>- è°ƒç”¨**EnumerableRel#implement**ç”ŸæˆEnumerableRel.Resultï¼ˆç”¨æ¥ç”Ÿæˆplanæ‰§è¡Œçš„javaä»£ç ï¼‰
- ç”Ÿæˆ**ClassDeclaration**çš„å®ä¾‹ï¼Œå°†ä¸¤ä¸ªé»˜è®¤çš„æˆå‘˜æ–¹æ³•å¡«å……ï¼ˆé€šè¿‡ç¬¬ä¸€æ­¥ç”Ÿæˆçš„Resultå¾—åˆ°ï¼‰;
</code></pre><ul>
<li>â€”&gt;<code>JdbcImplementor</code>: ç»§æ‰¿<code>RelToSqlConverter</code>ï¼Œä¸»è¦ç”¨æ¥è·å–RelNodeå¯¹åº”çš„SqlNodeï¼Œç„¶åé€šè¿‡SqlNodeå¾—åˆ°å¯¹åº”çš„sqlè¯­å¥ã€‚è¿”å›çš„sqlè¯­å¥ä¸€èˆ¬ç”¨ä½œå¡«å……è¿›ä¸Šå±‚çš„Converterçš„implementæ–¹æ³•äº§ç”Ÿçš„javaä»£ç ä¸­ã€‚</li>
</ul>
<blockquote>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæœ€ç»ˆResultSetçš„next()æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº†Cursorçš„next()æ–¹æ³•ï¼Œè€ŒCursorçš„next()æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šåœ¨è°ƒç”¨linq4jåŒ…ä¸‹çš„<a href="https://github.com/apache/calcite/blob/295ab13e8338bdd0e0c29e051907371c9b2929aa/linq4j/src/main/java/org/apache/calcite/linq4j/Linq4j.java#L668" target="_blank" rel="noopener">EnumeratorIterator</a>çš„hasNext()å’Œnext()æ–¹æ³•ï¼Œä¸”åœ¨åˆå§‹åŒ–Iteratorçš„æ—¶å€™ä¼šå…ˆè°ƒç”¨next()æ–¹æ³•æ¥ç¡®å®šæ˜¯å¦hasNextï¼Œå³hasNext()æ˜¯ç”±next()æ–¹æ³•ç¡®å®šçš„ã€‚æœ€ç»ˆnext()æ–¹æ³•æ˜¯è°ƒç”¨Bindableè¿”å›çš„Enumerableå¯¹è±¡äº§ç”Ÿçš„Enumeratorå¯¹è±¡çš„moveNextæ–¹æ³•</p>
<p>åœ¨prepareAndExecuteæ–¹æ³•ä¼šå…ˆexecuteæ‰¾åˆ°ç¬¬ä¸€ä¸ªå­˜åœ¨çš„è¡Œï¼Œä¹‹åè¿”å›ï¼Œè¿›è¡ŒResultSetéå†</p>
</blockquote>
<h1 id="è§£ç­”ç–‘é—®"><a href="#è§£ç­”ç–‘é—®" class="headerlink" title="è§£ç­”ç–‘é—®"></a>è§£ç­”ç–‘é—®</h1><p>Q1:</p>
<p>é€šè¿‡æ„é€ ä¸å­˜åœ¨è¡¨æ˜ï¼Œé€šè¿‡å¼‚å¸¸æ ˆçš„åˆ†æå¯ä»¥å¾—çŸ¥ï¼Œåœ¨<code>IdentifierNamespace#resolveImpl</code>æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œé€šè¿‡é˜…è¯»ä»£ç å¾—çŸ¥ï¼Œæ˜¯åœ¨å¤šæ¬¡<code>parentScope.resolveTable</code>å¤±è´¥åç¡®è®¤æ— æ³•åŒ¹é…ï¼Œä»è€Œåœ¨validateè¿‡ç¨‹ä¸­å°±å¯¹è¡¨æ˜¯å¦å­˜åœ¨è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœå­˜åœ¨<strong>å¾—åˆ°å¯¹åº”çš„<code>RelOptTable</code></strong></p>
<p>åœ¨SqlNode -&gt; RelNodeçš„convertä¸­ä¹Ÿä¼šå…ˆç”Ÿæˆ<strong><code>RelOptTable</code></strong></p>
<p>é€šè¿‡å¯¹<code>CsvTableScan</code>çš„æ„é€ å‡½æ•°debugï¼Œåœ¨sqlToRelConvertçš„æ—¶å€™ä¼š<strong>æ„é€ scanè¡¨æ‰€å¯¹åº”çš„<code>RelNode</code></strong></p>
<p>Q2:</p>
<p>é€šè¿‡Q1çš„åˆ†æï¼Œä»¥åŠå¯¹ç›¸å…³ç±»çš„debug</p>
<ul>
<li>CsvSchemaFactoryæ˜¯åœ¨validateç”Ÿæˆ<strong><code>RelOptTable</code></strong>çš„æ—¶å€™è°ƒç”¨ï¼Œç”Ÿæˆäº†Schemaä¸‹å­˜åœ¨çš„tables</li>
<li>åœ¨convertçš„æ—¶å€™ç›´æ¥å¤ç”¨å¡«å……è¿›<code>RelOptTable</code></li>
<li>åœ¨<code>RelOptTable</code>ä¸­æ ¹æ®å¡«å……çš„tableå®ç°çš„æ¥å£ï¼Œå¦‚ï¼ˆTranslatableTable, ScannableTableï¼‰æ¥ç¡®å®šå…¶å¦‚ä½•è½¬åŒ–æˆ<code>RelNode</code></li>
</ul>
<h1 id="å¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®ç°å¹³å°é—´æ•°æ®è¿ç§»"><a href="#å¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®ç°å¹³å°é—´æ•°æ®è¿ç§»" class="headerlink" title="å¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®ç°å¹³å°é—´æ•°æ®è¿ç§»"></a>å¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®ç°å¹³å°é—´æ•°æ®è¿ç§»</h1><h3 id="å‰æé—®é¢˜ï¼š"><a href="#å‰æé—®é¢˜ï¼š" class="headerlink" title="å‰æé—®é¢˜ï¼š"></a>å‰æé—®é¢˜ï¼š</h3><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å¼„æ¸…æ¥šä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p>Q1: ç¡®å®šä¸åŒæ•°æ®æºå³æ•°æ®åœ¨ä¸åŒçš„Conventionä¸­æ˜¯å¦‚ä½•æ·»åŠ Converterè¿›è¡ŒConventionçš„è½¬æ¢çš„?</p>
<p>Q2: æ·»åŠ å®ŒConverteråï¼ŒConverteræ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œæ˜¯å¦å¯ä»¥é›†æˆåœ¨Calciteä¸­ï¼Ÿ</p>
<p>ä¸‹é¢é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œè¿›è¡Œä»£ç debug ï¼Œç”±äºæ­¤å¤„éœ€è¦Converterï¼Œå› æ­¤æ­¤å¤„ç”¨calciteçš„jdbc adapterè®¿é—®clickhouseæ¥æ„é€ æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> project_name, project_name <span class="keyword">FROM</span> clickhouse.em_projects <span class="keyword">as</span> p;</span><br></pre></td></tr></table></figure>
<p>Q1: </p>
<p>é€šè¿‡debug optimzeçš„è¿‡ç¨‹ä¸­plançš„å˜åŒ–ï¼Œå¾—çŸ¥planæ˜¯åœ¨changeTraitså®Œä¹‹åsetRootæ—¶å€™æ·»åŠ ä¸ŠConverterçš„ï¼Œæ­¤æ—¶æ˜¯ä¸€ä¸ªAbstractConverterï¼ˆå¾…implementï¼‰</p>
<p>é€šè¿‡debug findBestExpçš„è¿‡ç¨‹ä¸­æ•´ä¸ªmemoçš„å˜åŒ–ï¼ˆè§„åˆ™åŒ¹é…ï¼‰ï¼Œå‘ç°ExpandConversionRuleæ˜¯ç”¨æ¥implement AbstractConverterçš„è§„åˆ™ï¼Œ<strong>è¿™ä¸ªè§„åˆ™ä¼šå°†AbstractConverterè½¬åŒ–ä¸ºä¸€ä¸ªconverteré“¾</strong>ï¼Œä»è€Œå¾—åˆ°ç›®æ ‡çš„conventionã€‚é€šè¿‡ä¹‹å‰å»ºç«‹<strong>è½¬åŒ–å›¾çš„ä¼ é€’é—­åŒ…</strong>(è§ä¹‹å‰addRuleå‡½æ•°çš„ä»‹ç»)ï¼Œè¿™é‡Œä¼šé€‰æ‹©æœ€çŸ­çš„é“¾ã€‚</p>
<blockquote>
<p>å¦‚æœtarget subsetå·²ç»å­˜åœ¨implementationï¼Œåˆ™ä¸ä¼šè§¦å‘</p>
<p>å¦‚æœsource subsetæ˜¯abstractçš„ï¼Œé‚£ä¹ˆä¼šæ ‡è®°è¯¥subsetï¼Œä¸€æ—¦æœ‰non-abstractçš„rel expæ·»åŠ è¿›å»å°±è§¦å‘è½¬æ¢</p>
</blockquote>
<p>å› æ­¤è¿™é‡Œæœ€å…ˆåŒ¹é…è¯¥è§„åˆ™åç”±äºinput/source çš„subsetæ˜¯abstractçš„ï¼Œå› æ­¤æ— æ•ˆã€‚ç»§è€ŒåŒ¹é…å…¶ä»–è§„åˆ™ï¼Œæœ€ç»ˆæ˜¯JdbcToEnumerableConverterRule, JdbcProjectRuleå¾—åˆ°äº†æœ€ä¼˜çš„planã€‚</p>
<p>Q2ï¼š</p>
<p>ç”±Step2ä¸­å…³äºRelNode-&gt;Bindableçš„å†…å®¹å¯ä»¥å¾—çŸ¥ï¼Œå°†RelNodeè½¬åŒ–ä¸ºçœŸæ­£å¯ä»¥æ‰§è¡Œçš„planï¼Œéœ€è¦<code>RelImplementor</code>å¾—åˆ°Javaä»£ç åç¼–è¯‘æ‰§è¡Œã€‚</p>
<p>é¦–å…ˆå…ˆçœ‹ä¸‹ç›®æ ‡ç”Ÿæˆçš„javaä»£ç é•¿ä»€ä¹ˆæ ·å­:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> org.apache.calcite.linq4j.<span class="function">Enumerable <span class="title">bind</span><span class="params">(<span class="keyword">final</span> org.apache.calcite.DataContext root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> org.apache.calcite.linq4j.function.Function1 rowBuilderFactory = <span class="keyword">new</span> org.apache.calcite.linq4j.function.Function1() &#123;</span><br><span class="line">        <span class="keyword">public</span> org.apache.calcite.linq4j.function.<span class="function">Function0 <span class="title">apply</span><span class="params">(<span class="keyword">final</span> java.sql.ResultSet resultSet)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> org.apache.calcite.linq4j.function.Function0() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">final</span> Object[] values = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line">                        values[<span class="number">0</span>] = resultSet.getObject(<span class="number">1</span>);</span><br><span class="line">                        values[<span class="number">1</span>] = resultSet.getObject(<span class="number">2</span>);</span><br><span class="line">                        <span class="keyword">return</span> values;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (java.sql.SQLException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                                e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">                    ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(<span class="keyword">final</span> Object resultSet)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> apply(</span><br><span class="line">                    (java.sql.ResultSet) resultSet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">            ;</span><br><span class="line">    <span class="keyword">final</span> org.apache.calcite.runtime.ResultSetEnumerable enumerable = org.apache.calcite.runtime.ResultSetEnumerable.of((javax.sql.DataSource) root.getRootSchema().getSubSchema(<span class="string">"clickhouse"</span>).unwrap(javax.sql.DataSource.class), <span class="string">"SELECT `project_name`, `project_name` AS `project_name0`\nFROM `default`.`em_projects`"</span>, rowBuilderFactory);</span><br><span class="line">    enumerable.setTimeout(root);</span><br><span class="line">    <span class="keyword">return</span> enumerable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Class <span class="title">getElementType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> java.lang.Object[].class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°æœ€ç»ˆè¿”å›çš„æ˜¯<code>ResultSetEnumerable</code>å¯¹è±¡ï¼Œå…¶<u>æœ¬è´¨ä¸Šæ˜¯å°†jdbcæŸ¥è¯¢clickhouseä¹‹åè¿”å›çš„resultSetå°è£…åˆ°Eumeratorä¸­è¿›è¡Œè¿­ä»£</u></p>
<p>è€Œå…·ä½“ç”Ÿæˆæ­¤å¤„ä»£ç çš„é€»è¾‘ï¼Œåˆ™åœ¨<code>JdbcToEnumerableConverter#implement</code>ä¸­ï¼Œæ„å»ºäº†è¿™æ ·çš„ä¸€ä¸ªExpression Tree</p>
<blockquote>
<p>ç”±æ­¤å¯è§å®ç°Converterï¼Œæœ€é‡è¦å°±æ˜¯å®ç°å¯¹åº”Converterçš„Implementä»£ç æ¥å®ŒæˆExpression Treeï¼ˆgenerating java codeï¼‰çš„ç”Ÿæˆ</p>
</blockquote>
<h3 id="å®ç°é—®é¢˜ï¼š"><a href="#å®ç°é—®é¢˜ï¼š" class="headerlink" title="å®ç°é—®é¢˜ï¼š"></a>å®ç°é—®é¢˜ï¼š</h3><p>ä»¥å®ç°clickhouseå’Œpostgresçš„joinä¸ºä¾‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> project_name, <span class="keyword">name</span> <span class="keyword">FROM</span> clickhouse.em_projects <span class="keyword">as</span> p <span class="keyword">join</span> postgre.employees <span class="keyword">as</span> e <span class="keyword">on</span> p.manager_id = e.id;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>JDBC.clickhouse</strong> convert to <strong>JDBC.postgres</strong>çš„ruleä»€ä¹ˆåœ°æ–¹æ·»åŠ ï¼Ÿ</li>
<li>converterçš„implementæ€ä¹ˆè¡¨è¾¾è¿ç§»çš„æ“ä½œï¼Ÿ</li>
</ol>
<p>å¯¹äº1ï¼Œåœ¨JdbcConventionæ³¨å†Œæ—¶å€™ï¼Œé€šè¿‡registeræ–¹æ³•è¿›è¡Œè§„åˆ™çš„æ·»åŠ ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªé™æ€å˜é‡å­˜å‚¨å·²ç»å­˜åœ¨çš„jdbc conventionï¼Œç„¶åä¸¤ä¸¤ç»„åˆç”Ÿæˆè½¬åŒ–è§„åˆ™ã€‚</p>
<p>å¯¹äº2ï¼Œåœ¨è§„åˆ™åŒ¹é…å®Œæˆç”Ÿæˆconverterä¹‹åï¼Œéœ€è¦åœ¨implementçš„æ—¶å€™è¡¨è¾¾è¿ç§»å®Œæˆçš„è¡¨ï¼Œç”±äºconvertå¿…å®šæœ‰parentçš„Jdbcç®—å­ï¼Œå› æ­¤ä¸å¯èƒ½ç›´æ¥implementï¼Œç”±ä¹‹å‰<a href="https://github.com/apache/calcite/blob/5c477f0dee1b9f709016a63ae8e5b824fb560585/core/src/main/java/org/apache/calcite/adapter/jdbc/JdbcToEnumerableConverter.java#L85" target="_blank" rel="noopener">JdbcToEnumerableConverter#implement</a>ä»£ç å¯çŸ¥ï¼Œæ ¸å¿ƒæ˜¯ç”Ÿæˆå¯¹åº”çš„SQLè¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SqlString <span class="title">generateSql</span><span class="params">(SqlDialect dialect)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> JdbcImplementor jdbcImplementor =</span><br><span class="line">      <span class="keyword">new</span> JdbcImplementor(dialect,</span><br><span class="line">          (JavaTypeFactory) getCluster().getTypeFactory());</span><br><span class="line">  <span class="keyword">final</span> JdbcImplementor.Result result =</span><br><span class="line">      jdbcImplementor.visitChild(<span class="number">0</span>, getInput());</span><br><span class="line">  <span class="keyword">return</span> result.asStatement().toSqlString(dialect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œ<code>JdbcImplementor</code>ä¸»è¦å·¥ä½œæ˜¯æŠŠRelNodeè½¬åŒ–æˆSqlï¼Œå› æ­¤åœ¨visitåˆ°æˆ‘ä»¬çš„convertèŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ç±»ä¼¼äºvisit TableScanèŠ‚ç‚¹çš„æ–¹å¼è¿”å›å¯¹è¿ç§»è¡¨çš„FROMè¯­å¥å³å¯ã€‚è€Œåœ¨è¯¥visitæ–¹æ³•ä¸­å¯ä»¥åŠ å…¥è°ƒç”¨è¿ç§»æ“ä½œçš„ä»£ç ã€‚å› æ­¤è¿ç§»è¿™é‡Œè®¾è®¡æ˜¯åœ¨implementæ—¶è¿›è¡Œçš„ã€‚</p>
<h1 id="å¦‚ä½•åšåˆ°è·¨å¹³å°çš„Join-Reorder"><a href="#å¦‚ä½•åšåˆ°è·¨å¹³å°çš„Join-Reorder" class="headerlink" title="å¦‚ä½•åšåˆ°è·¨å¹³å°çš„Join Reorder"></a>å¦‚ä½•åšåˆ°è·¨å¹³å°çš„Join Reorder</h1><h1 id="å…ƒæ•°æ®ç®¡ç†éƒ¨åˆ†"><a href="#å…ƒæ•°æ®ç®¡ç†éƒ¨åˆ†" class="headerlink" title="å…ƒæ•°æ®ç®¡ç†éƒ¨åˆ†"></a>å…ƒæ•°æ®ç®¡ç†éƒ¨åˆ†</h1><h1 id="ä¸€äº›å°å‘"><a href="#ä¸€äº›å°å‘" class="headerlink" title="ä¸€äº›å°å‘"></a>ä¸€äº›å°å‘</h1><ol>
<li><p>è¿è¡Œç¯å¢ƒè®¾ç½®ä¸ºsparkï¼Œåˆ™DataContextæ˜¯SlimDataContextï¼Œé‡Œé¢å•¥ä¹Ÿæ²¡æœ‰ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šç©ºæŒ‡é’ˆã€‚å®˜æ–¹sparkæ¨¡å—çš„testcaseçš„æ•°æ®æºå…¨éƒ½æ˜¯ä¸éœ€è¦è®¿é—®Schemaä¿¡æ¯çš„å†…å­˜é‡Œçš„Value, å› æ­¤ä¸ä¼šå¤±è´¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> DataContext <span class="title">createDataContext</span><span class="params">(Map&lt;String, Object&gt; parameterValues,</span></span></span><br><span class="line"><span class="function"><span class="params">    CalciteSchema rootSchema)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (config().spark()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SlimDataContext();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> DataContextImpl(<span class="keyword">this</span>, parameterValues, rootSchema);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Implementation of &#123;<span class="doctag">@link</span> DataContext&#125; that has few variables and is</span></span><br><span class="line"><span class="comment">   * &#123;<span class="doctag">@link</span> Serializable&#125;. For Spark. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SlimDataContext</span> <span class="keyword">implements</span> <span class="title">DataContext</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SchemaPlus <span class="title">getRootSchema</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JavaTypeFactory <span class="title">getTypeFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryProvider <span class="title">getQueryProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="å†™åœ¨æœ€åï¼šCalciteæºç é˜…è¯»å¿ƒå¾—"><a href="#å†™åœ¨æœ€åï¼šCalciteæºç é˜…è¯»å¿ƒå¾—" class="headerlink" title="å†™åœ¨æœ€åï¼šCalciteæºç é˜…è¯»å¿ƒå¾—"></a>å†™åœ¨æœ€åï¼šCalciteæºç é˜…è¯»å¿ƒå¾—</h1><p>åˆçª¥é˜¶æ®µï¼šé˜…è¯»å®˜æ–¹tutorialï¼Œå­¦ä¼šä½¿ç”¨ç³»ç»Ÿï¼Œ<strong>äº†è§£ç³»ç»Ÿçš„åŠŸèƒ½</strong>(input, output)</p>
<p>ç‚¼æ°”é˜¶æ®µï¼šé€šè¿‡åˆ«äººæ€»ç»“ï¼ˆå®˜æ–¹æ–‡æ¡£/åšå®¢ï¼‰<strong>äº†è§£å¤§è‡´çš„å†…éƒ¨é€»è¾‘å’Œæ¨¡å—çš„åˆ’åˆ†</strong></p>
<p>ç­‘åŸºé˜¶æ®µï¼šå¯¹<strong>è°ƒç ”å…³é”®æ¨¡å—äº†è§£å…¶åŸºæœ¬æ€æƒ³</strong>ï¼Œé˜…è¯»ç›¸å…³åšå®¢ï¼ˆTiDBä¼˜åŒ–å™¨çš„åšå®¢ï¼‰å’Œè®ºæ–‡ï¼ˆquery optimizer: Cascades/Volcano/SystemRï¼‰</p>
<p>é‡‘ä¸¹é˜¶æ®µï¼šæ„é€ å…¸å‹åœºæ™¯TestCaseï¼Œdebugä»£ç ï¼Œ<strong>äº†è§£ä»£ç å±‚é¢å„æ¨¡å—ä¸»è¦æ•°æ®ç»“æ„å’Œä¹‹é—´çš„äº¤äº’é€»è¾‘ï¼ˆè¯¦ç•¥å¾—å½“ï¼‰</strong></p>
<p>å…ƒå©´é˜¶æ®µï¼šæå‡ºæ”¹è¿›ï¼Œ<strong>æ›´åŠ æ·±å…¥äº†è§£æ”¹è¿›æ¶‰åŠé€»è¾‘çš„æ•°æ®ç»“æ„åŠç®—æ³•ï¼Œç¡®è®¤æ”¹è¿›çš„å¯è¡Œæ–¹æ¡ˆ</strong></p>
<p>åŒ–ç¥é˜¶æ®µï¼šæœªçŸ¥ä¸”ç¥ç§˜ï¼Œå¾…è§£é”</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h1><ol>
<li>å®˜ç½‘æ•™ç¨‹:  <a href="https://calcite.apache.org/docs/index.html" target="_blank" rel="noopener">https://calcite.apache.org/docs/index.html</a></li>
<li>Calciteç®€ä»‹ï¼š<a href="https://www.slideshare.net/JordanHalterman/introduction-to-apache-calcite" target="_blank" rel="noopener">https://www.slideshare.net/JordanHalterman/introduction-to-apache-calcite</a></li>
<li>Cascades / Volcano: <a href="https://15721.courses.cs.cmu.edu/spring2019/papers/22-optimizer1/xu-columbia-thesis1998.pdf" target="_blank" rel="noopener">https://15721.courses.cs.cmu.edu/spring2019/papers/22-optimizer1/xu-columbia-thesis1998.pdf</a></li>
<li>æ•°æ®åº“CMUè¯¾ç¨‹ï¼š<a href="https://15721.courses.cs.cmu.edu/spring2019/schedule.html" target="_blank" rel="noopener">https://15721.courses.cs.cmu.edu/spring2019/schedule.html</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/09/25/2019ç§‹æ‹›æ€»ç»“å’Œè‡ªçœ/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/25/2019ç§‹æ‹›æ€»ç»“å’Œè‡ªçœ/" itemprop="url">2019ç§‹æ‹›æ€»ç»“å’Œè‡ªçœ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-25T18:33:37+08:00">
                2019-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/æˆé•¿/" itemprop="url" rel="index">
                    <span itemprop="name">æˆé•¿</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ç§‹æ‹›å³å°†ç»“æŸäº†ï¼Œå›½å†…çš„å¤§å‚åŸºæœ¬éƒ½å·²ç»é¢å®Œäº†ï¼Œè¿˜å‰©ä¸‹ä¸€äº›å¤–ä¼æ²¡æœ‰é¢å®Œã€‚æ„Ÿè§‰è‡ªå·±å·²ç»æ¸æ¸ä»ç§‹æ‹›çš„çŠ¶æ€ä¸­èµ°å‡ºæ¥äº†ï¼Œä¸ºäº†é¿å…å¿˜è®°ï¼Œå› æ­¤å†™äº†è¿™ç¯‡åšå®¢ï¼Œç”¨æ¥è®°å½•è‡ªå·±çš„ç§‹æ‹›ç»å†ï¼Œä»¥åŠå¯¹æ­¤æ¬¡ç§‹æ‹›çš„ä¸€äº›æ€»ç»“å’Œåçœã€‚</p>
<p>æ–‡ç« ä¼šåˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>æ•´ä¸ªç§‹æ‹›çš„å›é¡¾</li>
<li>æ”¶è·ä»¥åŠä¸è¶³</li>
</ol>
<h4 id="Part1-ç§‹æ‹›å›é¡¾"><a href="#Part1-ç§‹æ‹›å›é¡¾" class="headerlink" title="Part1: ç§‹æ‹›å›é¡¾"></a>Part1: ç§‹æ‹›å›é¡¾</h4><p>é¦–å…ˆåˆ—å‡ºç›®å‰é¢çš„å…¬å¸ä»¥åŠæ‹¿åˆ°æ„å‘ä¹¦çš„æ—¶é—´ï¼š</p>
<table>
<thead>
<tr>
<th>å…¬å¸</th>
<th>æ—¶é—´</th>
</tr>
</thead>
<tbody>
<tr>
<td>TP-Link</td>
<td>6.27</td>
</tr>
<tr>
<td>åä¸ºæ˜Ÿï¼ˆsspï¼‰</td>
<td>7.24</td>
</tr>
<tr>
<td>è…¾è®¯TEGï¼ˆsspï¼‰</td>
<td>8.23</td>
</tr>
<tr>
<td>ç½‘æ˜“æ¸¸æˆä¼ç¾²ï¼ˆspï¼‰</td>
<td>8.30</td>
</tr>
<tr>
<td>é˜¿é‡Œäº‘ï¼ˆa-spï¼‰</td>
<td>9.24</td>
</tr>
<tr>
<td>æ‹¼å¤šå¤šå¤§æ•°æ®</td>
<td>10.9</td>
</tr>
</tbody>
</table>
<p>è¿™æ¬¡ç§‹æ‹›çš„æ—¶é—´çº¿æ‹‰çš„å¾ˆé•¿ï¼Œå®äº‹ä¸Šå¯ä»¥è¯´ä»æ˜¥æ‹›æˆ‘å°±å¼€å§‹æœ‰æ„è¯†çš„å‡†å¤‡äº†ã€‚æ—©æœŸçš„æ€è·¯æ¯”è¾ƒç®€å•ï¼Œå…ˆæŒ‘è‚¯å®šéœ€è¦èŠ±é•¿æ—¶é—´å¤ä¹ æ‰æœ‰æ•ˆæœçš„å†…å®¹å¼€å§‹å¤ä¹ ã€‚</p>
<p>äºæ˜¯ä»ä¸‰æœˆä»½å¼€å§‹å°±å¼€å§‹åˆ·leetcodeäº†ï¼Œé¡ºå¸¦ç€å»å­¦ä¹ ä¹‹å‰ä¸€çŸ¥åŠè§£çš„çŸ¥è¯†ç‚¹ã€‚å½“æ—¶ä¹Ÿä¼šå»çœ‹ä¸€äº›å‰è¾ˆçš„åšå®¢å­¦ä¹ å…³äºå¦‚ä½•å¤ä¹ çš„ä»¥åŠä¸€äº›çŸ¥è¯†ç‚¹çš„æ•´ç†å’Œæ€»ç»“ã€‚åœ¨å››æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘ç»“åˆä¹‹å‰çœ‹çš„åšå®¢ä»¥åŠå’Œå°ä¼™ä¼´çš„äº¤æµï¼Œè‡ªå·±å½’çº³äº†ä¸€ä¸ªå¤ä¹ çŸ¥è¯†ç‚¹çš„æ¡†æ¶ï¼Œç„¶åå¾€é‡Œé¢å¡«ä¸œè¥¿ã€‚</p>
<blockquote>
<p><a href="https://github.com/pilife/knowledge-review" target="_blank" rel="noopener">https://github.com/pilife/knowledge-review</a></p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘çš„å¤ä¹ ä¸»çº¿å°±åˆ†ä¸ºä¸¤ä¸ªï¼Œåˆ·é¢˜å’ŒçŸ¥è¯†ç‚¹çš„å­¦ä¹ ã€‚</p>
<p><strong>åœ¨åˆ·é¢˜æ–¹é¢</strong>ï¼Œæˆ‘ä¸»è¦å°±æ˜¯åˆ·leetcodeï¼Œæˆ‘åˆ·çš„æ–¹æ³•æ˜¯å¼€å§‹ç›´æ¥é¡ºåºåˆ·ï¼Œå¤§çº¦åˆ·äº†120é¢˜å·¦å³ï¼Œå¼€å§‹æŒ‰ç±»åˆ«åˆ·ï¼ŒæŒ‰ç±»åˆ«åˆ·äº†50é¢˜å·¦å³ã€‚è¿™é‡Œæˆ‘æŒ‰ç±»åˆ«åˆ·ä¸»è¦æ˜¯é€šè¿‡Googleä¸“é—¨å¯¹å¥³ç”Ÿçš„Programä¸Šçš„é¢˜ç›®åˆ—è¡¨ä»¥åŠè‡ªå·±ç¬”è¯•çš„æ—¶å€™å‘ç°ä¸è¶³æ‰¾ç›¸å…³ç±»çš„é¢˜ç›®åˆ·ã€‚</p>
<p>è¯´ä¸€ç‚¹è‡ªå·±åˆ·é¢˜çš„å¿ƒå¾—ï¼Œå¯èƒ½ä¸æ˜¯æ¯ä¸ªäººéƒ½é€‚ç”¨ã€‚æˆ‘æ˜¯é¾Ÿé€Ÿåˆ·çš„åšå®šä»£è¡¨è€…ï¼Œè¿™é‡Œçš„é¾Ÿé€Ÿåˆ·æ˜¯æŒ‡å°½é‡ä¸çœ‹ç­”æ¡ˆï¼Œç»™è‡ªå·±æ€è€ƒçš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œä¸€é¢˜å¤§æ¦‚åŠä¸ªå°æ—¶çš„æ€è€ƒæ—¶é—´æˆ‘éƒ½æ˜¯å¯ä»¥æ¥å—çš„ï¼ˆå®Œå…¨æ²¡æœ‰æ€è·¯å¤§çº¦ç†æ€§åˆ†æä¸ª10åˆ†é’Ÿï¼Œç¡®è®¤è‡ªå·±çœŸçš„ç›®å‰å®Œå…¨æ²¡æœ‰æ€è·¯å°±ä¼šå»çœ‹ç­”æ¡ˆï¼‰ã€‚ç„¶åçœ‹ç­”æ¡ˆä¹Ÿåˆ†å‡ ç§ï¼Œä¸€ç§æ˜¯å¤§çº¦æ‰«ä¸€ä¸‹å…³é”®è¯ï¼ŒçŸ¥é“è¿™é¢˜çš„å…³é”®æ–¹æ³•ï¼Œæ¯”å¦‚iterator, heapç­‰ç­‰ã€‚ç„¶åç»§ç»­æ€è€ƒã€‚ã€‚ã€‚ä¸€èˆ¬è¿™ç§æç¤ºå‡ºæ¥ä¹‹åä¼šç•¥å¾®åˆä¸€äº›æ€è·¯ã€‚å¦‚æœ10åˆ†é’Ÿä»ç„¶æƒ³ä¸å‡ºæ¥ï¼Œå°±ä¼šå»çœ‹å®Œæ•´çš„ç­”æ¡ˆã€‚è¿™æ ·åšçš„æ•ˆæœæ˜¯ï¼Œèƒ½å¤ŸçœŸåˆ‡çš„ä½“ä¼šåˆ°è‡ªå·±ä¸ºä»€ä¹ˆæ²¡æœ‰æƒ³åˆ°ã€‚è‡ªå·±çš„æ€è·¯å“ªé‡Œå‡ºäº†é—®é¢˜æ²¡æœ‰æƒ³åˆ°ã€‚è¿™ä¸€ç‚¹åœ¨æ€»ç»“å’Œå½’çº³å„ç±»è§£é¢˜æ–¹æ³•çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œèƒ½å¤Ÿæ¸…æ¥šçš„çŸ¥é“æ¯ä¸€é¢˜çš„ç‰¹ç‚¹ä»è€Œå¯¼è‡´ä½¿ç”¨ä»€ä¹ˆæ ·çš„è§£é¢˜æ–¹æ³•ã€‚</p>
<p><strong>å…³äºçŸ¥è¯†ç‚¹å¤ä¹ </strong>ï¼Œæˆ‘çš„å­¦ä¹ è·¯çº¿åˆ†ä¸ºä¸¤æ¡ã€‚<u>ä¸€æ¡æ˜¯å¤ä¹ é›¶æ•£çš„çŸ¥è¯†ç‚¹</u>ï¼Œè¿™ä¸€å—æˆ‘çš„æ–¹å¼æ˜¯ç”±ç‚¹åˆ°é¢ã€‚ä»ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œä¼šå‘ç°å¾ˆå¤šç›²åŒºï¼Œæ ¹æ®é‡è¦ç¨‹åº¦æ¥ç¡®å®šæ˜¯ä¸æ˜¯è¦å»ç»§ç»­æ¢ç´¢ã€‚<u>å¦ä¸€æ¡æ˜¯ç³»ç»Ÿåœ°å¤ä¹ </u>ï¼Œæ¯”å¦‚è¯´å¤ä¹ JAVAï¼Œç³»ç»Ÿçš„å­¦ä¹ äº†ã€Šæ·±å…¥ç†è§£JVMã€‹è¿™æœ¬ä¹¦ã€‚åœ¨ç³»ç»Ÿå­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿä¸èƒ½ç›²ç›®é¡ºç€çœ‹ã€‚ä¸€èˆ¬ä¹¦çš„å‰å‡ èŠ‚ä¼šæ¯”è¾ƒç²¾å½©ï¼Œå¼•äººå…¥èƒœã€‚çœ‹åˆ°åé¢éœ€è¦è‡ªå·±å¯¹è‡ªå·±æé—®ï¼Œæ‰¾åˆ°è‡ªå·±çš„å…´è¶£ç‚¹ï¼Œç„¶åæŸ¥ç›®å½•æ‰¾åˆ°å¯¹åº”çš„åœ°æ–¹è¿›è¡Œå­¦ä¹ ï¼Œè¿™æ ·ä¸»åŠ¨å¼çš„æå‡ºé—®é¢˜ï¼Œåœ¨ä¹¦ä¸­æ‰¾åˆ°è§£ç­”ä¼šå¾ˆé«˜æ•ˆã€‚</p>
<blockquote>
<p>çŸ¥è¯†ç‚¹å¤ä¹ ä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£JVMã€‹,ã€ŠDDIAã€‹,ã€ŠCSAPPã€‹</p>
</blockquote>
<p>ä¸Šé¢è¯´äº†ä¸€äº›å¤ä¹ çš„å¿ƒå¾—ï¼Œå¹²è„†æŠŠ<strong>é¢è¯•å‡†å¤‡çš„å¿ƒå¾—</strong>ä¹Ÿä¸€å¹¶è¯´äº†ã€‚é¦–å…ˆæ˜¯ç®€å†çš„å‡†å¤‡ï¼Œç®€å†æˆ‘ç”¨çš„æ˜¯wondercvï¼Œåœ¨è¿™ä¹‹å‰æˆ‘æ£é¼“äº†å¾ˆå¤šæ¨¡ç‰ˆï¼Œæœ‰mdçš„ï¼Œæœ‰latexçš„ï¼Œæœ€åå‘ç°è¿˜æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„æ•´å¥—æœåŠ¡çˆ½ï¼Œè‡ªåŠ¨ä¸€é¡µçº¸ï¼Œä¸­è‹±æ–‡ç®€å†ï¼Œè‡ªåŠ¨æ’åºÂ·Â·Â·æ€»ä¹‹æœæ–­ä¹°äº†ä¼šå‘˜ã€‚ç®€å†çš„æ’°å†™å…¶å®ç°åœ¨å„ç§å‰è¾ˆæ€»ç»“çš„å¾ˆå¥½ï¼Œä¸»è¦æ˜¯çªå‡ºè‡ªå·±çš„å·¥ä½œé‡ç‚¹ï¼Œçªå‡ºå·¥ä½œæ•ˆæœï¼Œä»¥åŠæ•…æ„æš´éœ²ä¸€äº›è€ƒç‚¹å¼•è¯±é¢è¯•å®˜å“ˆå“ˆå“ˆï½ç„¶åé¢è¯•çš„æ—¶å€™æ³¨æ„çªå‡ºè‡ªå·±è´¡çŒ®ä»¥åŠæ•ˆæœï¼Œä»¥åŠæåˆ°ä¹‹å‰å‡†å¤‡çš„è€ƒç‚¹ã€‚æ¥ä¸‹æ¥å°±çœ‹é¢è¯•å®˜äº†ï¼Œé—®åˆ°ä¹‹å‰å¤ä¹ è¿‡çš„è€ƒç‚¹è‡ªç„¶æ˜¯å¥½ï¼Œæ²¡æœ‰é—®åˆ°æˆ–è€…é—®åˆ°è‡ªå·±å‡†å¤‡çš„çŸ¥è¯†ç‚¹ç›²åŒºåˆ™ä¹Ÿæ˜¯å®è´µçš„ç»éªŒï¼Œé¢å®Œèµ¶å¿«æ¶è¡¥ï¼Œå› ä¸ºé¢è¯•å®˜é—®çš„é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯ç»å…¸çš„æœ‰ä»·å€¼çš„é—®é¢˜ã€‚é¢è¯•æœ€åå¯ä»¥å’¨è¯¢ä¸‹æ±‚èŒéƒ¨é—¨çš„å‘å±•æƒ…å†µï¼Œæ•°æ®çš„é‡çº§ä»¥åŠå¢é•¿ï¼Œä¸»è¦ä¸šåŠ¡æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¯¹è‡ªå·±æœªæ¥èŒä¸šå‘å±•ä¸Šçš„å»ºè®®ã€‚è¿™äº›éƒ½æ˜¯å¾ˆå®è´µçš„ï¼Œå› ä¸ºä¸€èˆ¬é¢åˆ°åé¢éƒ½æ˜¯å¤§ä½¬ï¼Œèƒ½å¤Ÿå’Œå¤§ä½¬äº¤æµè¿™äº›çš„æœºä¼šå¾ˆçè´µã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘çš„å¤ä¹ å’Œé¢è¯•çš„ä¸€äº›ç»éªŒã€‚æˆ‘å¤ä¹ çš„æ—¶é—´å¤§æ¦‚æ˜¯ä¸‰æœˆåˆ°äº”æœˆï¼ŒæœŸé—´åœ¨åæ³°è¯åˆ¸å®ä¹ ã€‚å½“æ—¶æ­£å¥½ä¹Ÿæ˜¯æ˜¥æ‹›çš„æ—¶é—´ï¼ŒæŠ•äº†è…¾è®¯ï¼Œé˜¿é‡Œçš„å®ä¹ ç”Ÿï¼Œå½“æ—¶æ‰å¼€å§‹å¤ä¹ ï¼Œå…¨éƒ½æ˜¯ä¸€é¢æŒ‚ã€‚ä¸è¿‡<u>å½“æ—¶çš„æ¢ç´¢ç»™æˆ‘ä¹‹åç¡®å®šå¤ä¹ çš„æ–¹å‘å¾ˆå¤§çš„å¸®åŠ©</u>ã€‚ä¹‹åå…­æœˆåˆ°å…«æœˆåœ¨å¤´æ¡å®ä¹ ï¼Œå¤ä¹ åŸºæœ¬éƒ½æ˜¯é ä¸­åˆåƒé¥­ï¼Œæ™šä¸Šä¸‹ç­å’Œå‘¨æœ«æŒ¤å‡ºçš„æ—¶é—´ã€‚æœŸé—´æ•´ä¸ªäººéƒ½æ˜¯æ‰“é¸¡è¡€çš„ã€‚å¤´æ¡çš„å®ä¹ ä¸å…‰æ˜¯å¢åŠ äº†å®ä¹ ç»å†è¿™ä¹ˆç®€å•ï¼ŒåŒ…æ‹¬è®¤è¯†äº†å¾ˆæ£’çš„ä¼™ä¼´ï¼Œæ¥è§¦äº†å·¥ä¸šç•Œçš„å†…éƒ¨å¹³å°ï¼Œå‚åŠ äº†toBçš„é¡¹ç›®ã€‚ç»™æˆ‘çš„è®¤çŸ¥å¸¦æ¥äº†éå¸¸å¤§çš„æ”¹å˜ï¼Œéå¸¸æ„Ÿè°¢å¤´æ¡ï¼Œä¹Ÿæ„Ÿè°¢é‚£ä¸ª<u>å‹‡äºå°è¯•æ–°ç¯å¢ƒï¼Œå‹‡äºæŒ‘æˆ˜çš„è‡ªå·±</u>ã€‚</p>
<p>ä¸‹é¢æŒ‰æ—¶é—´é¡ºåºèŠä¸€äº›å„ä¸ªå…¬å¸çš„æ„Ÿå—å§ï¼ˆä»…é™äºæˆ‘é¢è¯•çš„éƒ¨é—¨å’ŒèŒä½ï¼‰ã€‚</p>
<ul>
<li>TP-LINKï¼šæŠ¥åçš„æå‰æ‰¹ã€‚é¢è¯•å®˜åº”è¯¥ä¸æ˜¯æå¤§æ•°æ®çš„ï¼Œä¸­è§„ä¸­çŸ©ï¼Œæœ‰ç‚¹ä¹…è¿œè®°ä¸æ¸…äº†ã€‚</li>
<li>åä¸ºï¼šæŠ¥åçš„åä¸ºæ˜Ÿè®¡åˆ’<ul>
<li>ä¸€é¢ä¸€å †é¢˜ç›®é‡Œé€‰ï¼Œæ‰‹å†™é¢˜ç›®ï¼ŒçœŸâ€˜æ‰‹å†™â€™ï¼Œé¢˜ç›®å¾ˆç®€å•ï¼Œæˆ‘é€‰äº†ä¸ªéš¾ä¸€äº›çš„è§£å†³äº†ï¼Œå’Œé¢è¯•å®˜æ¢è®¨äº†ä¸‹é”™è¯¯å’Œæ­£ç¡®çš„æ€è·¯ï¼Œæ•´ä¸ªè¿‡ç¨‹å¾ˆæ„‰å¿«ã€‚</li>
<li>äºŒé¢åŸºæœ¬åœ¨é—®æˆ‘çš„ç´ è´¨ï¼ŒåHRé¢ã€‚ç„¶åç¬”è¯•+æµ‹è¯„ï¼ˆæµ‹è¯„æŒ‚äº†ä¸€æ¬¡- -!ï¼‰ã€‚</li>
</ul>
</li>
<li>è…¾è®¯ï¼šæŠ¥çš„æˆ‘å¥³ç¥¨è®¡ç®—æ‰€çš„å®šå‘æ‹›è˜ã€‚å“ˆå“ˆå“ˆï¼Œæˆ‘ä¹Ÿç®—åŠä¸ªè®¡ç®—æ‰€çš„äººã€‚<ul>
<li>ä¸€é¢ç”µè¯é¢ï¼Œé¢è¯•å®˜ç…ç€å¾ˆå¹´è½»ï¼Œé—®äº†äº›åˆ†å¸ƒå¼ç›¸å…³çš„æ¦‚å¿µã€‚æœ‰æ²¡æœ‰ç­”ä¸Šæ¥äº†ï¼Œæ¯”å¦‚zabï¼Œå›å»æ¶è¡¥ã€‚</li>
<li>äºŒé¢é¢è¯•å®˜å¾ˆç‰¹åˆ«ï¼Œå¾ˆæœ‰æ°´å¹³ï¼Œé—®äº†æˆ‘ä¸€äº›è‡ªå·±çš„è§è§£å’ŒæŠ½è±¡ã€‚æ¯”å¦‚JVMçš„ç†è§£ï¼Œåƒåœ¾å›æ”¶çš„ç†è§£ã€‚çœŸçš„å¾ˆæ£’ã€‚è€ƒæ•°æ®ç»“æ„ç®—æ³•éå¸¸çµæ´»ï¼ŒèŠåˆ°å“ªç®—å“ªï¼Œæœ€åç‰¹å®šæƒ…å†µä¸‹å¿«æ’çš„ç¨³å®šæ€§çš„åˆ†ææˆ‘è„‘æŠ½è¿˜ç­”é”™äº†ï¼ˆé¢˜ç›®æ˜¯æˆ‘è‡ªå·±æŒ–çš„å‘- -ï¼‰ï¼Œå¤§å†™çš„å°´å°¬ã€‚</li>
<li>ä¸‰é¢é¢è¯•å®˜ä¸€å¼€å§‹å¾ˆå†·å³»ï¼Œæ°”åœºå¾ˆè¶³ï¼Œå‰é¢é—®äº†æˆ‘Hbaseçš„WALä¼˜åŒ–æˆ‘æ²¡æœ‰ç­”ä¸Šæ¥ï¼Œå†…å¿ƒå¤§å†™çš„ä¸å¦™ã€‚åæœŸé—®äº†ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªåˆ†æ¡¶çš„å¤§æ•°æ®é¢˜çœŸçš„æ˜¯æˆ‘çµå…‰ä¹ç°æƒ³å‡ºæ¥çš„ï¼ˆä¹‹åæ¶è¡¥äº†è¿™ç±»é¢˜ç›®ï¼‰ã€‚æœ€åç®—æ³•ä¸éš¾ï¼Œå¾ˆå¿«å°±å†™å‡ºæ¥äº†ã€‚æœ€åèŠå¤©é˜¶æ®µé¢è¯•å®˜ç«Ÿç„¶éœ²å‡ºäº†å’Œå–„çš„å¾®ç¬‘ã€‚ï¼ˆç‘Ÿç‘Ÿå‘æŠ–ï¼Œå¥½æ€•ç¬‘ç€è¯´å†è§ï¼‰</li>
</ul>
</li>
<li>ç½‘æ˜“ï¼šæŠ¥åçš„æå‰æ‰¹<ul>
<li>ä¸€é¢èŠäº†å¾ˆå¤šJAVAçš„å¸¸ç”¨ç±»åº•å±‚å®ç°ã€‚</li>
<li>äºŒé¢æ—¶é—´å¾ˆçŸ­ï¼ŒèŠäº†å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚</li>
<li>ä¸‰é¢èŠäº†ä¸€äº›æƒ³æ³•ï¼Œä¹Ÿè€ƒäº†ä¸€äº›linuxçš„åŸºæœ¬ä½¿ç”¨ã€‚ç‰¹åˆ«çš„ï¼Œä¸‰é¢é¢è¯•å®˜æŸå”è¶…çº§niceï¼Œç‰¹åœ°åˆèŠ±äº†ä¸€ä¸ªå°æ—¶ç»™æˆ‘è¯¦ç»†è®²è§£äº†ä»–ä»¬éƒ¨é—¨çš„æƒ…å†µã€‚</li>
</ul>
</li>
<li>é˜¿é‡Œï¼šå¸ˆå…„å†…æ¨<ul>
<li>ä¸€é¢æ˜¯å¸ˆå…„çš„leaderï¼Œå¸ˆå…„è¯´è¿™ä¸ªè·ªäº†å°±å’Œé˜¿é‡Œå†è§äº†ã€‚ã€‚è´¼ç´§å¼ ï¼Œæˆ‘è®°å¾—å½“æ—¶ç­‰çš„æ—¶å€™æ‰‹å¿ƒéƒ½æ˜¯æ±—ã€‚é¢èµ·æ¥ä¹‹åå°±å¥½äº†ï¼ŒèŠäº†ä¸€äº›é¡¹ç›®ï¼Œåšäº†ä¸‰é¢˜ä¸éš¾çš„ç®—æ³•ï¼ŒèŠäº†ä¼šå„¿LSMã€‚</li>
<li>äºŒé¢é¢è¯•å®˜è€ƒäº†ä¸€ä¸ªå‡ ä½•é¢˜ï¼Œå½“æ—¶é€šè¿‡ç‰¹ä¾‹æƒ³åˆ°äº†ä¸€ä¸¢ä¸¢æ€è·¯ï¼Œç»“æœèµ°å²”äº†ã€‚è€ƒäº†ä¸€é¢˜24ç‚¹ã€‚</li>
<li>ä¸‰é¢é¢è¯•å®˜æ˜¯éƒ¨é—¨å¤§Bossã€‚èŠäº†å¾ˆå¤šä»–ä»¬éƒ¨é—¨åšçš„ä¸œè¥¿ï¼Œåšäº†ä¸€é¢˜é€šé…ç¬¦åŒ¹é…çš„é¢˜ç›®ã€‚ç­”çš„å¾ˆä¸€èˆ¬ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚</li>
<li>äº¤å‰é¢é¢è¯•å®˜å’Œè…¾è®¯äºŒé¢é¢è¯•å®˜ä¸€æ ·ç»™æˆ‘å¾ˆæ·±çš„å°è±¡ã€‚é¦–å…ˆè€ƒäº†æˆ‘ä¸€é¢˜å¾ˆæœ‰æ„æ€çš„é¢˜ç›®ï¼Œæ˜¯éšå«çš„æ•°åˆ—é¢˜ã€‚æ­£è§£æ˜¯æ–æ³¢é‚£å¥‘é¢æ•°åˆ—ã€‚æˆ‘ä¸€é¡¿åˆ†æï¼ŒæŠŠé¢˜ç›®æŠ½è±¡æˆæ•°åˆ—é¢˜ï¼Œåªç­”å‡ºæ¥ç­‰æ¯”æ•°åˆ—å¯¹åº”çš„è§£ã€‚å¿˜äº†æ–æ³¢é‚£å¥‘é€šé¡¹å…¬å¼ã€‚ä¹‹ååˆé—®äº†æˆ‘å‘äººæ·±çœçš„é—®é¢˜ï¼Œä½ è§‰å¾—è‡ªå·±åšçš„ä»€ä¹ˆä½ æœ€è‡ªè±ªï¼Ÿæœ€åç»™äº†æˆ‘ä¸€äº›æœªæ¥å·¥ä½œä¸Šçš„å»ºè®®ï¼Œè¦æ‰¾æœ‰ä»·å€¼çš„ä¸œè¥¿åšã€‚æ”¶è·æ»¡æ»¡ã€‚</li>
</ul>
</li>
<li>pddï¼šå­¦éœ¸æ‰¹ã€‚æˆ‘å¯èƒ½æ˜¯æœ€èœçš„å­¦éœ¸æ‰¹ã€‚<ul>
<li>ä¸€é¢è§†é¢‘é¢ã€‚é—®äº†æˆ‘ä¸€äº›å¤§æ•°æ®ç›¸å…³ç³»ç»Ÿçš„åŸºæœ¬é—®é¢˜ï¼Œspark shuffleï¼Œhbaseä»¥åŠä¸€äº›å…·ä½“åœºæ™¯çš„ä½¿ç”¨ã€‚é—®äº†è·³è¡¨çš„ä¼˜ç‚¹ï¼Œå…³äºæ–¹ä¾¿å¹¶è¡ŒåŒ–è¿™ä¸€ç‚¹æ²¡æœ‰ç­”ä¸Šæ¥ã€‚æœ€åäº¤æµäº†éƒ¨é—¨çš„æƒ…å†µã€‚</li>
<li>äºŒé¢è§†é¢‘é¢ï¼Œé¢è¯•å®˜ä¸Šæ¥è€ƒäº†æ­£åˆ™åŒ¹é…ï¼Œ10minå†™å‡ºæ¥ã€‚æˆ‘æ€è·¯å±€é™åœ¨ä¹‹å‰å†™è¿‡çš„é€šé…ç¬¦åŒ¹é…ä¸Šäº†ï¼Œæ²¡æœ‰è½¬è¿‡å¼¯æ¥ï¼Œè½¬è¿‡æ¥çš„æ—¶å€™å·²ç»è¿‡äº†ä¸€åŠæ—¶é—´äº†ã€‚ã€‚å‹‰å¼ºå†™äº†å…³é”®çš„åˆ¤æ–­å’Œé€’å½’ã€‚ç„¶åè€ƒäº†æˆ‘hbaseçš„åŸç†ä»¥åŠhdfsçš„å®ç°ï¼Œè¿™è¾¹æœ‰ä¸€äº›æ²¡æœ‰ç­”ä¸Šæ¥æ¯”å¦‚hbase compact/splitç»†èŠ‚ï¼Œhdfså¿«ç…§åŸç†ä»¥åŠå­˜å‚¨é—®é¢˜ã€‚ç„¶åé—®äº†æˆ‘ä¸€äº›è‡ªæˆ‘è®¤çŸ¥ã€‚</li>
</ul>
</li>
</ul>
<h4 id="Part2-æ”¶è·åŠä¸è¶³"><a href="#Part2-æ”¶è·åŠä¸è¶³" class="headerlink" title="Part2: æ”¶è·åŠä¸è¶³"></a>Part2: æ”¶è·åŠä¸è¶³</h4><p>ä»ä¸‰æœˆåˆ°ä¹æœˆï¼ŒåŠå¹´çš„æ—¶é—´ã€‚è¿™åŠå¹´ï¼Œæœ‰è¿‡è¿·èŒ«ï¼Œæœ‰è¿‡å¼€å¿ƒï¼Œæœ‰è¿‡å¤±è½ã€‚èµ°è¿‡æ¥å‘ç°è¿™ä¸€è·¯æ”¶è·äº†å¾ˆå¤šï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰åšåˆ°æœ€å¥½ã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘æœ€å¤§çš„æ”¶è·å°±æ˜¯åœ¨å¤´æ¡å®ä¹ çš„3ä¸ªæœˆï¼Œæœ‰çœ¼ç•Œçš„æå‡ï¼Œæœ‰è®¤çŸ¥çš„ä¸°å¯Œï¼Œå½“ç„¶ï¼Œè¿˜æœ‰ä½“é‡çš„é£™å‡:)ã€‚ã€‚æ€»ä¹‹éå¸¸æ„Ÿè°¢è¿™æ®µç»å†ï¼Œniceçš„ç¯å¢ƒï¼Œniceçš„åŒäº‹ï¼Œç»™äº†æˆ‘ä¸€ä¸ªå°å°çš„èœ•å˜ã€‚</li>
<li>å…¶æ¬¡æ˜¯å­¦ä¼šåˆ¶å®šè®¡åˆ’ã€‚å¯èƒ½è¯´å‡ºæ¥æœ‰äº›å¯ç¬‘ï¼Œä¹‹å‰çš„æˆ‘ä»æ¥æ²¡æœ‰ç»™è‡ªå·±è®¤è®¤çœŸçœŸçš„åˆ¶å®šè¿‡ç³»ç»Ÿçš„è®¡åˆ’ï¼Œæœ€å¤šå°±æ˜¯ä¸€äº›çŸ­æœŸçš„è§„åˆ’ã€‚è¿™åŠå¹´é‡Œï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä»¥åŠå¹´ä¸ºå•ä½è¿›è¡Œè®¡åˆ’ï¼ŒåŒ…æ‹¬äº†æ‰¾å·¥ä½œï¼Œæ¯•è®¾ï¼Œå…´è¶£å­¦ä¹ ä¸‰ä¸ªæ–¹é¢ã€‚ä»¥é•¿æœŸè®¡åˆ’ä½œä¸ºå¯¼å‘ï¼Œæ¿€åŠ±è‡ªå·±ï¼Œæ¯å½“æˆ‘è§‰å¾—è¦æ”¾æ¾çš„æ—¶å€™ï¼Œè¿™äº›è®¡åˆ’æ€»èƒ½ç»™æˆ‘ç¥å¥‡çš„åŠ›é‡ã€‚æ¥ç€å°±æ˜¯çŸ­æœŸè®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€å¤©ï¼Œæ¯ä¸€å‘¨è¦å®Œæˆä»€ä¹ˆã€‚ä¸¤è€…ç»“åˆï¼Œè®©æˆ‘èƒ½å¤Ÿå®‰ç¨³åœ°èµ°åœ¨è·¯ä¸Šã€‚</li>
<li>è¿˜æœ‰å°±æ˜¯å­¦ä¹ æ–¹å¼çš„ä¸æ–­æ”¹è¿›ã€‚ä¸æ–­å»æ€è€ƒæ”¹è¿›è‡ªå·±çš„å­¦ä¹ æ¨¡å¼ï¼Œæ€»ç»“å‡ºäº†éå¸¸é€‚åˆæˆ‘è‡ªå·±ï¼Œä»¥è‡ªæˆ‘å‘æ˜å…´è¶£ä¸ºæ•²é—¨ç –çš„å­¦ä¹ æ–¹æ³•ã€‚è¾…åŠ©ä»¥ä¸€äº›å¸®åŠ©è¿›å…¥å­¦ä¹ çŠ¶æ€çš„æ‰‹æ®µï¼ˆæˆ‘ç”¨çš„æ˜¯forestè¿™ä¸ªappï¼‰ï¼Œå¯ä»¥ç»´æŒè‡ªå·±å­¦ä¹ çŠ¶æ€ã€‚</li>
<li>å…»æˆäº†æ—¥è®°çš„ä¹ æƒ¯ï¼Œæ¯å¤©çš„è§„åˆ’ä»¥åŠæ”¶è·ä¼šç®€çŸ­è®°å½•ï¼Œå›é¡¾æ—¶çŸ¥é“è‡ªå·±æ¯å¤©æ²¡æœ‰ç™½è¿‡ï¼Œä»è€Œæ­£å‘çš„æ¿€åŠ±è‡ªå·±ã€‚å…¶å®è¿™ä¸ªä¹ æƒ¯æ˜¯åœ¨å¤´æ¡å®ä¹ çš„æ—¶å€™ï¼Œæ¯å‘¨éœ€è¦æ€»ç»“å‘¨æŠ¥ï¼Œæ¯ä¸ªæœˆéœ€è¦è‡ªå·±æäº¤è€ƒå‹¤ã€‚å¾—æ¯”è¾ƒè¯¦ç»†çš„è®°å½•äº†è‡ªå·±çš„å·¥ä½œã€‚å½“æˆ‘å¼€å§‹è®°ä¹‹åï¼Œå¿½ç„¶å‘ç°åŸæ¥æ¯å¤©åšä¸€ä¸ªæ€»ç»“æ˜¯éå¸¸è‡ªç„¶ä¸”èˆ’æœçš„äº‹æƒ…ã€‚</li>
<li>è€Œä¸”è¿™æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œä¹ŸåŠ å›ºäº†æˆ‘æŠ€æœ¯ä¸Šçš„æ ¹åŸºã€‚</li>
<li>åšæŒäº†åŠå¹´æ¯å¤©èƒŒè‹±è¯­å•è¯ã€‚</li>
</ul>
<p>ä»¥ä¸Šå°±æ˜¯æ”¶è·äº†ï¼Œè™½ç„¶æ¯”è¾ƒæ»¡æ„ï¼Œä½†æ˜¯å…¶ä¸­è¿˜å­˜åœ¨ç€å¾ˆå¤šçš„ä¸è¶³ã€‚</p>
<ul>
<li>æœ€å¤§çš„é—®é¢˜å°±æ˜¯ç¡çœ é—®é¢˜ï¼ä¹ æƒ¯æ€§ç†¬å¤œã€‚ä»è€Œæ—©ä¸Šå¤±å»äº†å¾ˆå¤šæ—¶é—´å’Œæ•ˆç‡ã€‚</li>
<li>å…¶æ¬¡æ˜¯å¶å°”çš„æ¾æ‡ˆé—®é¢˜ï¼Œæœ‰æ—¶å€™å¤ªè¿‡æ”¾æ¾ï¼Œè®©è‡ªå·±å¤„äºä¸€ä¸ªä¸å¥åº·çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ‰“ä¸€å¤©çš„æ¸¸æˆã€‚ï¼ˆä½†æ˜¯éšå½¢å®ˆæŠ¤è€…æ˜¯çœŸçš„é¦™- -||ï¼‰</li>
<li>è¿˜æœ‰åˆ¶å®šè®¡åˆ’å¹¶ä¸ç§‘å­¦ï¼Œå¾ˆå¤šçŸ­æœŸè®¡åˆ’è®¾ç½®çš„å¹¶ä¸åˆç†ï¼Œå¾ˆå¤šè®¡åˆ’å¹¶æ²¡æœ‰å®Œæˆï¼Œå¯¼è‡´è‡ªå·±æš‚æ—¶æ€§çš„ä¸§æ°”/æ”¾æ¾</li>
</ul>
<p>è¿™äº›ä¸è¶³å’Œé—®é¢˜ï¼Œå‰ä¸¤è€…å·²ç»å…»æˆä¹ æƒ¯äº†ï¼Œæœ€åä¸€æ¡åˆ™å¯ä»¥é€šè¿‡ä¸æ–­çš„ç§¯ç´¯ç»éªŒæ¥è°ƒæ•´ã€‚å¯¹äºä¹‹å‰å…»æˆçš„åä¹ æƒ¯ï¼Œä¸€ç›´ä»¥æ¥éƒ½ä¸èƒ½æœ‰æ•ˆçš„æ”¹å˜ã€‚å› æ­¤æˆ‘å°è¯•ä»ä¹¦æœ¬ä¸Šè·å¾—è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ä¸€æœ¬ç»å…¸çš„è°ƒæ•´è‡ªæˆ‘çš„ä¹¦ç±ã€ŠThe Road Less Traveledã€‹ï¼Œç›®å‰æ‰å¼€å§‹çœ‹ï¼Œä½†æ˜¯æ¨è¿Ÿæ»¡è¶³æ„Ÿè¿™ä¸ªåŸåˆ™ï¼Œå·²ç»è®©æˆ‘æœ‰æ„è¯†çš„å’Œå¯»æ±‚å»‰ä»·æ»¡è¶³æ„Ÿçš„è‡ªå·±å¯¹æŠ—ï¼Œå¼€å§‹è°ƒæ•´è‡ªå·±çš„ä½œæ¯äº†ã€‚ç›¸åº”çš„æˆ‘ä¹Ÿå·²ç»å¼€å§‹ç€æ‰‹åšè‡ªå·±æ‰¾å®Œå·¥ä½œä¹‹åçš„é•¿çŸ­æœŸè®¡åˆ’äº†ï¼Œä¹‹åæœ‰æ—¶é—´ä¼šæ€»ç»“å’Œåˆ†äº«è‡ªå·±è®¡åˆ’çš„åˆ¶å®šä»¥åŠå®æ–½æ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/03/15/ä¸æ‡‚è¿™äº›ï¼Œè®¡ç®—æœºç½‘ç»œä½ å¯èƒ½ä¸€æ— æ‰€çŸ¥/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/15/ä¸æ‡‚è¿™äº›ï¼Œè®¡ç®—æœºç½‘ç»œä½ å¯èƒ½ä¸€æ— æ‰€çŸ¥/" itemprop="url">ä¸æ‡‚è¿™äº›ï¼Œè®¡ç®—æœºç½‘ç»œä½ å¯èƒ½ä¸€æ— æ‰€çŸ¥?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-15T21:45:17+08:00">
                2019-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/youshouldknow/" itemprop="url" rel="index">
                    <span itemprop="name">youshouldknow</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>ç½‘ç»œåˆ†å±‚</p>
<p>| Layer       | Protocol                |<br>| â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| Application | Telnet, FTP, etc        |<br>| Transport   | TCP, UDP                |<br>| Network     | IP, ICMP                |<br>| Link        | drivers, interface card |</p>
</li>
<li><p>æ•°æ®çš„å•å…ƒï¼šæŠ¥æ–‡ï¼ŒæŠ¥æ–‡æ®µï¼Œåˆ†ç»„/åŒ…ï¼Œæ•°æ®æŠ¥ï¼Œå¸§ï¼Œæ•°æ®å•å…ƒ</p>
<ul>
<li>Application Layer -&gt; æŠ¥æ–‡ï¼ˆmessageï¼‰</li>
<li>Transport Layer -&gt; TCP -&gt; æŠ¥æ–‡æ®µï¼ˆsegmentï¼‰</li>
<li>Transport/Network Layer -&gt; UDP/ IP -&gt; æ•°æ®æŠ¥ï¼ˆdatagramï¼‰</li>
<li>Transport/Network Layer -&gt; åˆ†ç»„/åŒ…ï¼ˆpacketï¼‰</li>
<li>Link Layer -&gt; å¸§ï¼ˆframeï¼‰</li>
</ul>
</li>
<li><p>TCP</p>
<ol>
<li><p>TCP Segment</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g13ip2xmihj30kp072jrj.jpg" alt="img"></p>
<p>ä»¥å¤ªç½‘æ•°æ®åŒ…ï¼ˆframeï¼‰çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œæœ€åˆæ˜¯1518å­—èŠ‚ï¼Œåæ¥å¢åŠ åˆ°1522å­—èŠ‚ã€‚å…¶ä¸­ï¼Œ 1500 å­—èŠ‚æ˜¯è´Ÿè½½ï¼ˆpayloadï¼‰ï¼Œ22å­—èŠ‚æ˜¯å¤´ä¿¡æ¯ï¼ˆheadï¼‰ã€‚</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g13j80o5d6g30bm06qmwy.gif" alt="ip packet"></p>
<p>IP æ•°æ®åŒ…åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…çš„è´Ÿè½½é‡Œé¢ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„å¤´ä¿¡æ¯ï¼Œæœ€å°‘éœ€è¦20å­—èŠ‚ï¼Œæ‰€ä»¥ IP æ•°æ®åŒ…çš„è´Ÿè½½æœ€å¤šä¸º1480å­—èŠ‚ã€‚</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g13j7708d2g30b708i3yb.gif" alt="tcp packet"></p>
<p>TCP æ•°æ®åŒ…åœ¨ IP æ•°æ®åŒ…çš„è´Ÿè½½é‡Œé¢ã€‚å®ƒçš„å¤´ä¿¡æ¯æœ€å°‘ä¹Ÿéœ€è¦20å­—èŠ‚ï¼Œå› æ­¤ TCP æ•°æ®åŒ…çš„æœ€å¤§è´Ÿè½½æ˜¯ 1480 - 20 = 1460 å­—èŠ‚ã€‚ç”±äº IP å’Œ TCP åè®®å¾€å¾€æœ‰é¢å¤–çš„å¤´ä¿¡æ¯ï¼Œæ‰€ä»¥ TCP è´Ÿè½½å®é™…ä¸º1400å­—èŠ‚å·¦å³ã€‚</p>
<p>å› æ­¤ï¼Œä¸€æ¡1500å­—èŠ‚çš„ä¿¡æ¯éœ€è¦ä¸¤ä¸ª TCP æ•°æ®åŒ…ã€‚HTTP/2 åè®®çš„ä¸€å¤§æ”¹è¿›ï¼Œ å°±æ˜¯å‹ç¼© HTTP åè®®çš„å¤´ä¿¡æ¯ï¼Œä½¿å¾—ä¸€ä¸ª HTTP è¯·æ±‚å¯ä»¥æ”¾åœ¨ä¸€ä¸ª TCP æ•°æ®åŒ…é‡Œé¢ï¼Œè€Œä¸æ˜¯åˆ†æˆå¤šä¸ªï¼Œè¿™æ ·å°±æé«˜äº†é€Ÿåº¦ã€‚</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g13ivy3aetj30ix08j3yf.jpg" alt="img"></p>
</li>
<li><p>æµç¨‹</p>
<ol>
<li>å»ºç«‹è¿æ¥ï¼šä¸‰æ¬¡æ¡æ‰‹</li>
<li>å‘é€æ•°æ®<ol>
<li>æ»‘åŠ¨çª—å£</li>
<li>æ…¢å¯åŠ¨</li>
</ol>
</li>
<li>æ–­å¼€è¿æ¥ï¼šå››æ¬¡æŒ¥æ‰‹</li>
</ol>
</li>
<li><p>ä¼˜ç‚¹</p>
<ul>
<li>é¢å‘è¿æ¥</li>
<li>å…·å¤‡é¡ºåºæ§åˆ¶</li>
<li>é‡å‘æ§åˆ¶ç­‰æœºåˆ¶</li>
</ul>
</li>
<li><p>åº”ç”¨åœºæ™¯</p>
<p>å¯ä»¥ä¸ºåº”ç”¨æä¾›å¯é çš„ä¼ è¾“ã€‚</p>
</li>
</ol>
</li>
<li><p>UDP</p>
<ol>
<li><p>UDP packet</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g13jpm4luog30aa03a3y9.gif" alt="img"></p>
</li>
<li><p>æµç¨‹</p>
</li>
<li><p>ä¼˜ç‚¹</p>
<blockquote>
<p>UDPæ•°æ®åŒ…é•¿åº¦</p>
<p>åœ¨æœ¬æœº(loopback)ä¼ è¾“ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®MTUï¼Œä½†è®°ä½ï¼ŒUDPæœ€å¤§ç†è®ºé•¿åº¦65507ã€‚</p>
<p>åœ¨å†…ç½‘ä¼ è¾“ï¼Œæœ€å¥½æ§åˆ¶åœ¨1472å­—èŠ‚(1500-8-20)ã€‚</p>
<p>åœ¨internetä¸Šä¼ è¾“ï¼Œæœ€å¥½æ§åˆ¶åœ¨548å­—èŠ‚(576-8-20)ä»¥å†…ã€‚</p>
</blockquote>
<blockquote>
<p> UDPæ”¶åŒ…èƒ½åŠ›</p>
<p>UDPå¤„ç†èƒ½åŠ›éå¸¸å¯è§‚ï¼Œåœ¨æ—¥å¸¸çš„ä¸šåŠ¡æƒ…å½¢ä¸­ï¼ŒUDPä¸€èˆ¬ä¸ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>éšç€è¿›ç¨‹ä¸ªæ•°çš„å¢åŠ ï¼Œå¤„ç†èƒ½åŠ›æœªæ˜æ˜¾ä¸Šå‡ï¼Œä½†æ˜¯ä¸¢åŒ…ä¸ªæ•°æ˜æ˜¾ä¸‹é™ã€‚</p>
<p>é‡‡ç”¨å¤šè¿›ç¨‹ç›‘å¬ä¸åŒç«¯å£çš„æ¨¡å‹ï¼Œè€Œä¸æ˜¯å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ç›‘å¬åŒä¸€ä¸ªç«¯å£ã€‚</p>
</blockquote>
</li>
<li><p>åº”ç”¨åœºæ™¯</p>
<p>media streaming </p>
</li>
</ol>
</li>
<li><p>IPåˆ†ç‰‡ä¸é‡ç»„</p>
</li>
</ul>
<p>Reference:</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/11636405/definition-of-network-units-fragment-segment-packet-frame-datagram" target="_blank" rel="noopener">Exploring the anatomy of a data packet</a></p>
<p><a href="https://www.techrepublic.com/article/exploring-the-anatomy-of-a-data-packet/" target="_blank" rel="noopener">Definition of Network Units: Fragment, Segment, Packet, Frame, Datagram</a></p>
<p><a href="https://blog.csdn.net/github_35124642/article/details/52006185" target="_blank" rel="noopener">IPåˆ†ç‰‡å’Œé‡ç»„</a></p>
<p><a href="https://www.cnblogs.com/linuxbug/p/4906000.html" target="_blank" rel="noopener">æµ…è°ˆUDP(æ•°æ®åŒ…é•¿åº¦ï¼Œæ”¶åŒ…èƒ½åŠ›ï¼Œä¸¢åŒ…åŠè¿›ç¨‹ç»“æ„é€‰æ‹©)</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/02/19/å‰ä»–ç»ƒä¹ å¿ƒå¾—ï¼ˆä»æ–°æ‰‹æˆé•¿è¿›é˜¶çš„è¿‡ç¨‹å’Œæ€»ç»“ï¼‰/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/å‰ä»–ç»ƒä¹ å¿ƒå¾—ï¼ˆä»æ–°æ‰‹æˆé•¿è¿›é˜¶çš„è¿‡ç¨‹å’Œæ€»ç»“ï¼‰/" itemprop="url">å‰ä»–ç»ƒä¹ å¿ƒå¾—ï¼ˆä»æ–°æ‰‹æˆé•¿è¿›é˜¶çš„è¿‡ç¨‹å’Œæ€»ç»“ï¼‰</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-19T13:45:24+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/éŸ³ä¹/" itemprop="url" rel="index">
                    <span itemprop="name">éŸ³ä¹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/02/19/ä¹ç†çŸ¥è¯†æ•´ç†ï¼ˆæŒç»­å­¦ä¹ ä¸­ï¼‰/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/ä¹ç†çŸ¥è¯†æ•´ç†ï¼ˆæŒç»­å­¦ä¹ ä¸­ï¼‰/" itemprop="url">ä¹ç†çŸ¥è¯†æ•´ç†ï¼ˆæŒç»­å­¦ä¹ ä¸­ï¼‰</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-19T13:44:24+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/éŸ³ä¹/" itemprop="url" rel="index">
                    <span itemprop="name">éŸ³ä¹</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h2 id="å¤§ç™½è¯éŸ³ä¹çš„åŸºæœ¬æ¦‚å¿µ"><a href="#å¤§ç™½è¯éŸ³ä¹çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å¤§ç™½è¯éŸ³ä¹çš„åŸºæœ¬æ¦‚å¿µ"></a>å¤§ç™½è¯éŸ³ä¹çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="å£°éŸ³çš„ç‰©ç†åŸç†"><a href="#å£°éŸ³çš„ç‰©ç†åŸç†" class="headerlink" title="å£°éŸ³çš„ç‰©ç†åŸç†"></a>å£°éŸ³çš„ç‰©ç†åŸç†</h3><p>å£°éŸ³æ˜¯ä¸€ç§æ³¢ï¼Œæ‰€ä»¥ç”±<u>æŒ¯å¹…ï¼Œé¢‘ç‡ï¼Œç›¸ä½</u></p>
<p><em>æŒ¯å¹…</em>å°±æ˜¯é€šå¸¸æ‰€è¯´çš„<strong>éŸ³é‡(volume)</strong></p>
<p><em>é¢‘ç‡</em>åˆ™æ˜¯<strong>éŸ³é«˜(pitch)</strong></p>
<p>æ³¢çš„å åŠ äº§ç”Ÿäº†ä¸åŒçš„<strong>éŸ³è‰²(timbre)</strong>ï¼Œè¿™é‡Œä¹Ÿæ¶‰åŠåˆ°äº†ä¸åŒ<em>ç›¸ä½æ³¢çš„å åŠ </em></p>
<h3 id="éŸ³ä¹çš„ä¸‰è¦ç´ "><a href="#éŸ³ä¹çš„ä¸‰è¦ç´ " class="headerlink" title="éŸ³ä¹çš„ä¸‰è¦ç´ "></a>éŸ³ä¹çš„ä¸‰è¦ç´ </h3><p>èŠ‚å¥ï¼Œæ—‹å¾‹ï¼Œå’Œå£°</p>
<p>èŠ‚å¥æ˜¯éŸ³ä¹çš„ç”Ÿå‘½</p>
<p>æ—‹å¾‹æ˜¯éŸ³ä¹çš„æ„Ÿæƒ…èµ°å‘</p>
<p>å’Œå£°æ˜¯ä½¿éŸ³ä¹è¡¨ç°åŠ›æ›´åŠ ä¸°å¯Œ</p>
<h3 id="éŸ³é«˜çš„åˆ’åˆ†â€”12å¹³å‡å¾‹"><a href="#éŸ³é«˜çš„åˆ’åˆ†â€”12å¹³å‡å¾‹" class="headerlink" title="éŸ³é«˜çš„åˆ’åˆ†â€”12å¹³å‡å¾‹"></a>éŸ³é«˜çš„åˆ’åˆ†â€”12å¹³å‡å¾‹</h3><h3 id="éŸ³åï¼Œå”±å"><a href="#éŸ³åï¼Œå”±å" class="headerlink" title="éŸ³åï¼Œå”±å"></a>éŸ³åï¼Œå”±å</h3><h3 id="ä¸ºä»€ä¹ˆåˆ’åˆ†è¿™äº›å”±åï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆ’åˆ†è¿™äº›å”±åï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ’åˆ†è¿™äº›å”±åï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆ’åˆ†è¿™äº›å”±åï¼Ÿ</h3><h3 id="å’Œå¼¦"><a href="#å’Œå¼¦" class="headerlink" title="å’Œå¼¦"></a>å’Œå¼¦</h3><h3 id="å¸¸ç”¨å’Œå¼¦è¿›è¡Œ"><a href="#å¸¸ç”¨å’Œå¼¦è¿›è¡Œ" class="headerlink" title="å¸¸ç”¨å’Œå¼¦è¿›è¡Œ"></a>å¸¸ç”¨å’Œå¼¦è¿›è¡Œ</h3><h3 id="ä»€ä¹ˆæ˜¯è°ƒï¼ŸCè°ƒï¼ŒDè°ƒï¼ŒXXè°ƒåˆ°åº•æ˜¯å•¥"><a href="#ä»€ä¹ˆæ˜¯è°ƒï¼ŸCè°ƒï¼ŒDè°ƒï¼ŒXXè°ƒåˆ°åº•æ˜¯å•¥" class="headerlink" title="ä»€ä¹ˆæ˜¯è°ƒï¼ŸCè°ƒï¼ŒDè°ƒï¼ŒXXè°ƒåˆ°åº•æ˜¯å•¥"></a>ä»€ä¹ˆæ˜¯è°ƒï¼ŸCè°ƒï¼ŒDè°ƒï¼ŒXXè°ƒåˆ°åº•æ˜¯å•¥</h3><h2 id="è¯†è°±ï¼Œä¸è¦åšæ–‡ç›²ï¼"><a href="#è¯†è°±ï¼Œä¸è¦åšæ–‡ç›²ï¼" class="headerlink" title="è¯†è°±ï¼Œä¸è¦åšæ–‡ç›²ï¼"></a>è¯†è°±ï¼Œä¸è¦åšæ–‡ç›²ï¼</h2><h3 id="äº”çº¿è°±ï¼šéŸ³ä¹çš„è¯­è¨€"><a href="#äº”çº¿è°±ï¼šéŸ³ä¹çš„è¯­è¨€" class="headerlink" title="äº”çº¿è°±ï¼šéŸ³ä¹çš„è¯­è¨€"></a>äº”çº¿è°±ï¼šéŸ³ä¹çš„è¯­è¨€</h3><h3 id="å…­çº¿è°±ï¼šä¸‡ä¸€æŒ‰é”™äº†å‘¢ï¼Œè¿˜æ˜¯è¦è¿™ä¸ªçº æ­£ä¸‹"><a href="#å…­çº¿è°±ï¼šä¸‡ä¸€æŒ‰é”™äº†å‘¢ï¼Œè¿˜æ˜¯è¦è¿™ä¸ªçº æ­£ä¸‹" class="headerlink" title="å…­çº¿è°±ï¼šä¸‡ä¸€æŒ‰é”™äº†å‘¢ï¼Œè¿˜æ˜¯è¦è¿™ä¸ªçº æ­£ä¸‹"></a>å…­çº¿è°±ï¼šä¸‡ä¸€æŒ‰é”™äº†å‘¢ï¼Œè¿˜æ˜¯è¦è¿™ä¸ªçº æ­£ä¸‹</h3><h2 id="ç»ƒç´å¿ƒå¾—"><a href="#ç»ƒç´å¿ƒå¾—" class="headerlink" title="ç»ƒç´å¿ƒå¾—"></a>ç»ƒç´å¿ƒå¾—</h2><h3 id="å…³äºçˆ¬æ ¼å­"><a href="#å…³äºçˆ¬æ ¼å­" class="headerlink" title="å…³äºçˆ¬æ ¼å­"></a>å…³äºçˆ¬æ ¼å­</h3><p>å¿…è¦æ€§ï¼šé¡¶å°–çš„å¤§å¸ˆï¼Œæ¯å¤©ä¹Ÿéƒ½ä¼šçˆ¬æ ¼å­ï¼Œä½•å†µå¾ç­‰ã€‚èƒ½å¤Ÿè®©ä½ çš„æ‰‹æŒ‡çµæ´»ï¼Œæœ‰åŠ›ï¼Œç‹¬ç«‹ã€‚</p>
<p>æ¨èçˆ¬æ ¼å­æ–¹æ³•ï¼šä»60å¼€å§‹ï¼Œå£°éŸ³é¥±æ»¡èŠ‚å¥ç¨³å®šä»¥åæé€Ÿ5ï¼Œæ­£å¸¸çˆ¬æ ¼å­é€Ÿåº¦ä¸€èˆ¬ç»ƒåˆ°100+ ï¼Œä¿ç•™æŒ‡çˆ¬æ ¼å­ä¸€èˆ¬ç»ƒåˆ°80é€Ÿå·¦å³ã€‚ èŠ‚æ‹ä½¿ç”¨å››å››æ‹ï¼Œå››åˆ†éŸ³ç¬¦ï¼Œæ¯ä¸ªéŸ³ç¬¦å¼¹ä¸¤ä¸‹ã€‚</p>
<p>çˆ¬æ ¼å­æ³¨æ„ï¼šä¸€å®šè¦é›†ä¸­æ³¨æ„åŠ›çˆ¬æ ¼å­ï¼ï¼ä¸€å®šè¦é›†ä¸­æ³¨æ„åŠ›çˆ¬æ ¼å­ï¼ï¼ä¸€å®šè¦é›†ä¸­æ³¨æ„åŠ›çˆ¬æ ¼å­ï¼ï¼ä¸è¦ä»¥ä¸ºè¿™æ˜¯æœºæ¢°çš„åŠ¨ä½œå°±ä¸è¦æ³¨æ„åŠ›äº†ï¼Œé›†ä¸­æ³¨æ„ï¼Œæ‰“å¼€æ‰‹æŒ‡ï¼ŒåŠªåŠ›å¼ å¼€åˆ°æœ€å¤§ï¼ŒæŒ‰çš„æœ€æ¥è¿‘å“æŸ±ã€‚ä¸ç„¶çˆ¬æ ¼å­å¹¶ä¸ä¼šå¸¦æ¥ä¸Šè¿°æ”¶ç›Šã€‚</p>
<p>å¯¹äº†ï¼Œå¾ˆåŠªåŠ›çš„çˆ¬æ ¼å­ä¹‹åï¼Œå†æŒ‰å’Œå¼¦ä¼šæ„Ÿè§‰æ‰‹æŒ‡å¾ˆçµæ´»ï¼Œå¾ˆè½»æ¾ã€‚å’Œå¥èº«åšå®Œå¤§é‡é‡åšå°é‡é‡ç±»ä¼¼çš„æ„Ÿè§‰ã€‚</p>
<h3 id="å…³äºå•éŸ³ç»ƒä¹ "><a href="#å…³äºå•éŸ³ç»ƒä¹ " class="headerlink" title="å…³äºå•éŸ³ç»ƒä¹ "></a>å…³äºå•éŸ³ç»ƒä¹ </h3><p>åœ¨è°ˆçš„æ—¶å€™ï¼Œæ”¾ç©ºå¤§è„‘ï¼Œæ„Ÿå—æŒ‡å°–çš„é£èˆï¼Œå•Šï½Stopï¼å•éŸ³ç»ƒä¹ ä¸€å®šè¦æŠŠè°ˆçš„éŸ³å”±å‡ºæ¥ï¼Œè¿™æ ·æ‰èƒ½å¢åŠ éŸ³åå’ŒæŒ‡æ¿ä½ç½®çš„mapçš„ç†Ÿæ‚‰åº¦ã€‚æœ€åå¯ä»¥åšåˆ°<strong>è§†è°±</strong>å°±é è¿™ä¸ªäº†ã€‚</p>
<h2 id="å°æœºçµé¬¼çš„é—®é¢˜"><a href="#å°æœºçµé¬¼çš„é—®é¢˜" class="headerlink" title="å°æœºçµé¬¼çš„é—®é¢˜"></a>å°æœºçµé¬¼çš„é—®é¢˜</h2><ol>
<li><p>éŸ³è‰²æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>è°æ³¢</p>
</li>
<li><p>ä¸ºä»€ä¹ˆæœ‰çš„åˆ†è§£å’Œå¼¦ï¼Œæœ€åçš„éŸ³ä¼šå˜æˆç©ºå¼¦ï¼Ÿ</p>
<p>å› ä¸ºå‰ä»–æ‰‹ä¸ºäº†è½¬æ¢å’Œå¼¦çš„æ–¹ä¾¿ï¼Œæå‰ç§»èµ°äº†ã€‚ç”±äºä¸æ˜¯æ ¹éŸ³ï¼ˆéŸ³ä¹çš„åˆ›ä½œåŸç†ï¼‰ï¼Œå½±å“ä¸æ˜¯å¾ˆå¤§å°±å¯ä»¥æ¥å—ï¼Œè€Œä¸”å¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ•ˆæœå“¦ã€‚</p>
</li>
<li><p>ä¸ºä»€ä¹ˆè¦å­¦ä¹ ä¸åŒçš„è°ƒçš„æŒ‡æ³•å‘¢ï¼Œå˜è°ƒå¤¹ä¸æ˜¯èƒ½è§£å†³ä¸€åˆ‡ä¹ˆï¼Ÿ</p>
<p>å˜è°ƒå¤¹è™½ç„¶å¾ˆå‰å®³ï¼Œè®©ä½ åªä¼šCè°ƒçš„æŒ‡æ³•ï¼ˆéŸ³é˜¶åœ¨æŒ‡æ¿ä¸Šçš„ä½ç½®ç†Ÿæ‚‰ï¼‰ï¼Œå´å¯ä»¥å¼¹å…¶ä»–è°ƒã€‚ä½†æ˜¯ï¼ï¼å¦‚æœä¸€é¦–æ­Œæœ‰å¥½å‡ ä¸ªè°ƒå‘¢ï¼Œéš¾é“ä½ è¦å¿«é€Ÿç§»åŠ¨å˜è°ƒå¤¹å—HHã€‚æ‰€ä»¥ä¸è¦å·æ‡’æœºçµé¬¼ä»¬ã€‚</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/02/19/å¥èº«ç†è®ºOverView/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/å¥èº«ç†è®ºOverView/" itemprop="url">å¥èº«ç†è®ºOverView</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-19T13:42:24+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/å¥èº«/" itemprop="url" rel="index">
                    <span itemprop="name">å¥èº«</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/02/19/2018-11-inch-ipad-pro/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/2018-11-inch-ipad-pro/" itemprop="url">2018 11 inch ipad pro</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-19T13:37:57+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tech-experiment/" itemprop="url" rel="index">
                    <span itemprop="name">tech experiment</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/01/13/protocol-buffers/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/protocol-buffers/" itemprop="url">protocol buffers</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-13T03:54:44+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ¬æ•™ç¨‹æ—¨åœ¨è®©æˆ‘ä»¬å­¦ä¼šï¼š</p>
<ol>
<li>å®šä¹‰ä¸€ä¸ª.protoæ–‡ä»¶</li>
<li>ä½¿ç”¨ protocol buffer complier</li>
<li>ç”¨æˆ· Java protocol buffer API æ¥è¯»å†™ä¿¡æ¯</li>
</ol>
<h4 id="é¦–å…ˆæˆ‘ä»¬ç»“åˆå®é™…çš„åº”ç”¨åœºæ™¯æ¥äº†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦protocol-buffers"><a href="#é¦–å…ˆæˆ‘ä»¬ç»“åˆå®é™…çš„åº”ç”¨åœºæ™¯æ¥äº†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦protocol-buffers" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬ç»“åˆå®é™…çš„åº”ç”¨åœºæ™¯æ¥äº†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦protocol buffers?"></a>é¦–å…ˆæˆ‘ä»¬ç»“åˆå®é™…çš„åº”ç”¨åœºæ™¯æ¥äº†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦protocol buffers?</h4><p>è¿™é‡Œæˆ‘ä»¬æ˜¯ç”¨ä¸€ä¸ªé€šè®¯å½•å¯¹æ–‡ä»¶çš„è¯»å†™æ¥å®Œæˆå¯¹ç”¨æˆ·é€šè®¯ä¿¡æ¯çš„è¯»å†™çš„ä¾‹å­ä½œä¸ºä»‹ç»ã€‚</p>
<p>å½“æˆ‘ä»¬è¦åºåˆ—åŒ–å’Œä»¥åŠæ¢å¤è¿™ç§æœ‰ç»“æ„çš„æ•°æ®ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ³•ã€‚</p>
<ul>
<li>åˆ©ç”¨Javaçš„åºåˆ—åŒ–æœºåˆ¶ã€‚ä½†æ˜¯å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š<ul>
<li>å­˜åœ¨è®¸å¤šä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ (see Effective Java, by Josh Bloch pp. 213)</li>
<li>ä¸èƒ½å¾ˆå¥½åœ°å’Œå…¶ä»–è¯­è¨€C++/Pythonå…±äº«æ•°æ®ï¼ˆå’Œè¯­è¨€çš„è€¦åˆæ€§å¤ªé«˜ï¼‰</li>
</ul>
</li>
<li>è‡ªå®šä¹‰ä¸€ä¸ªç‰¹å®šçš„ï¼ˆad-hocï¼‰æ–¹å¼æŠŠæ•°æ®é¡¹ç¼–ç æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ¯”å¦‚å°†å››ä¸ªæ•´æ•°ç¼–ç ä¸ºâ€12:3:-23:67â€ã€‚è¿™æ˜¯ä¸€ç§ç®€å•è€Œçµæ´»çš„æ–¹æ³•ï¼Œå°½ç®¡å®ƒéœ€è¦ç¼–å†™ä¸€æ¬¡æ€§ï¼ˆè¿™é‡Œçš„è‹±æ–‡æ˜¯one-off, æ„æ€ä¸ºhappen only onceï¼Œæˆ‘ç†è§£æ˜¯åªé€‚ç”¨äºè¿™ä¸ªåœºæ™¯çš„è§£ç å’Œç¼–ç æ–¹æ³•ï¼Œå› æ­¤ç¿»è¯‘ä¸ºä¸€æ¬¡æ€§çš„ï¼‰çš„ç¼–ç å’Œè§£ç çš„ä»£ç ï¼Œè€Œä¸”è§£ç ä¼šäº§ç”Ÿå¾ˆå°çš„è¿è¡Œæ—¶é—´æˆæœ¬ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼å¾ˆé€‚åˆç¼–ç ç®€å•çš„æ•°æ®ã€‚</li>
<li>å°†æ•°æ®åºåˆ—åŒ–ä¸ºXMLã€‚ è¿™ç§æ–¹æ³•å¯èƒ½éå¸¸æœ‰å¸å¼•åŠ›ï¼Œå› ä¸ºXMLæ˜¯å¯è¯»çš„ï¼Œå¹¶ä¸”æœ‰è®¸å¤šè¯­è¨€çš„ç»‘å®šåº“ã€‚ å¦‚æœæ‚¨æƒ³ä¸å…¶ä»–åº”ç”¨ç¨‹åº/é¡¹ç›®å…±äº«æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ ç„¶è€Œï¼ŒXMLæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ç©ºé—´å¯†é›†å‹ï¼Œ<u>ç¼–ç /è§£ç å¯èƒ½ä¼šç»™åº”ç”¨ç¨‹åºå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æŸå¤±</u>ã€‚ å¦å¤–ï¼Œå¯¼èˆªXML DOMæ ‘æ¯”å¯¼èˆªç±»ä¸­çš„ç®€å•å­—æ®µé€šå¸¸è¦å¤æ‚å¾—å¤šã€‚</li>
</ul>
<p>Protocol buffersæ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„çµæ´»ï¼Œé«˜æ•ˆçš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä½ åªéœ€è¦å†™ä¸€ä¸ªä½ æƒ³è¦å­˜å‚¨çš„æ•°æ®ç»“æ„çš„æè¿°.protoæ–‡ä»¶ã€‚ä¹‹åprotocol buffer compilerä¼šåˆ›å»ºä¸€ä¸ªç±»ã€‚è¿™ä¸ªç±»</p>
<ol>
<li>ç”¨é«˜æ•ˆçš„äºŒè¿›åˆ¶æ ¼å¼å®ç°äº†è‡ªåŠ¨ç¼–ç å’Œè§£ç ã€‚</li>
<li>å¯¹å­—æ®µæä¾›äº†getterså’Œsettersã€‚</li>
<li>å°†è¯»å†™çš„ç»†èŠ‚ä½œä¸ºä¸€ä¸ªå•å…ƒå¤„ç†</li>
<li>æ”¯æŒæ‹“å±•æ ¼å¼ï¼Œå¹¶ä¸”ä¿æŒå¯¹æ—§çš„ç¼–ç çš„æ•°æ®è¯»å–çš„å…¼å®¹ã€‚</li>
</ol>
<h4 id="ä¸‹é¢ä»‹ç»å…·ä½“çš„ä½¿ç”¨ï¼š"><a href="#ä¸‹é¢ä»‹ç»å…·ä½“çš„ä½¿ç”¨ï¼š" class="headerlink" title="ä¸‹é¢ä»‹ç»å…·ä½“çš„ä½¿ç”¨ï¼š"></a>ä¸‹é¢ä»‹ç»å…·ä½“çš„ä½¿ç”¨ï¼š</h4><ul>
<li><p>å®šä¹‰.protoæ–‡ä»¶çš„æ–¹å¼</p>
<ul>
<li>Extend info<ul>
<li>packageï¼ˆåŒºåˆ†ä¸åŒprojectï¼‰</li>
<li>java_packageï¼ˆjavaçš„åŒ…, default=packageï¼‰</li>
<li>java_outer_classnameï¼ˆjavaçš„ç±»å, default=filename2camelcaseï¼‰</li>
</ul>
</li>
<li>Massage declaration<ul>
<li>field types(default value): bool(false), int32(0), float(0), double(0), string(â€œâ€)</li>
<li>enumå®šä¹‰</li>
<li>tag: fieldåœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­ä½¿ç”¨çš„æ ‡è®°ã€‚æ‰€ä»¥1-15ï¼ˆéœ€è¦å°‘äºä¸€ä¸ªå­—èŠ‚ï¼‰ä¸€èˆ¬èµ‹äºˆå¸¸ç”¨çš„å’Œrepeatedçš„å…ƒç´ ã€‚&gt;=16çš„ç»™ä¸€äº›ä¸å¸¸ä½¿ç”¨çš„optionalå…ƒç´ ã€‚</li>
<li>modifiers: required(å°‘ç”¨ï¼Œå¯¹æ‹“å±•é™åˆ¶å¾ˆå¼º), optional, repeated</li>
</ul>
</li>
</ul>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">"proto2"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> tutorial;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> java_package = <span class="string">"com.example.tutorial"</span>;</span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">"AddressBookProtos"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">required</span> <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">required</span> <span class="built_in">int32</span> id = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">string</span> email = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">PhoneType</span> </span>&#123;</span><br><span class="line">    MOBILE = <span class="number">0</span>;</span><br><span class="line">    HOME = <span class="number">1</span>;</span><br><span class="line">    WORK = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">message</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">string</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">optional</span> PhoneType type = <span class="number">2</span> [default = HOME];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">repeated</span> PhoneNumber phones = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">AddressBook</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> Person people = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¯‘è¯¥æ–‡ä»¶(-Iç”¨äºimport)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc -I=$SRC_DIR --java_out=$DST_DIR $SRC_DIR/addressbook.proto</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”Ÿæˆçš„Classæ–‡ä»¶å¦‚ä½•ä½¿ç”¨ï¼ˆç”Ÿæˆäº†ä»€ä¹ˆï¼Œæä¾›äº†ä»€ä¹ˆåŠŸèƒ½ï¼‰</p>
<ul>
<li><p>ç”Ÿæˆäº†Messageå¯¹åº”çš„classã€‚æ¯ä¸ªclassæœ‰è‡ªå·±çš„Builderã€‚ä¸”ç”±protocol compilerç”Ÿæˆçš„ç±»éƒ½æ˜¯å¯¹åº”JAVAé£æ ¼çš„é©¼å³°å‘½åã€‚<u>è¿™é‡Œå»ºè®®åœ¨.protoæ–‡ä»¶ä¸­ä½¿ç”¨å°å†™å­—æ¯+ä¸‹åˆ’çº¿</u>ã€‚ï¼ˆå› ä¸ºprotocol compileræ˜¯åœ¨å°å†™å­—æ¯+ä¸‹åˆ’çº¿è§„èŒƒä¸Šï¼Œè§£æç”Ÿæˆå¯¹åº”è¯­è¨€çš„é£æ ¼çš„ä»£ç ï¼‰</p>
</li>
<li><p>Message: ä¿¡æ¯å¯¹è±¡ï¼Œimmutableï¼Œä¸å¯è¢«ä¿®æ”¹</p>
<ul>
<li>Singular field: has, get</li>
<li>Repeated fields: getList, getCount, get(index)</li>
<li>æ ‡å‡†æ–¹æ³•ï¼ŒMessageæ¥å£å£°æ˜çš„<ul>
<li>isInitialized(): checks if all the required fields have been set.</li>
<li>toString(): returns a human-readable representation of the message, particularly useful for debugging</li>
</ul>
</li>
<li>åºåˆ—åŒ–å’Œè§£ç <ul>
<li>byte[] toByteArray();: serializes the message and returns a byte array containing its raw bytes.</li>
<li>static Person parseFrom(byte[] data);: parses a message from the given byte array.</li>
<li>void writeTo(OutputStream output);: serializes the message and writes it to an OutputStream.</li>
<li>static Person parseFrom(InputStream input);: reads and parses a message from an InputStream.</li>
</ul>
</li>
</ul>
</li>
<li><p>Builder: ä¿¡æ¯å¯¹è±¡çš„æ„é€ å™¨ï¼Œç”¨æ¥åˆ›å»ºmassageå¯¹è±¡</p>
<ul>
<li>Singular field: has, get, set, clear</li>
<li>Repeated fields: getList, getCount, get(index), set(index, value), add(value), addAll(value), clear</li>
<li>æ ‡å‡†æ–¹æ³•ï¼ŒMessage.Builderæ¥å£å£°æ˜çš„<ul>
<li>isInitialized()</li>
<li>toString()</li>
<li>mergeFrom(Message other):  merges the contents of other into this message, overwriting singular scalar fields, merging composite fields, and concatenating repeated fields</li>
<li>clear(): clears all the fields back to the empty state</li>
</ul>
</li>
</ul>
</li>
<li><p>Enums and Nested Classes:</p>
<p>æšä¸¾ç±»å‹ä¼šè‡ªåŠ¨åœ¨å£°æ˜çš„ç±»çš„å†…éƒ¨ç”Ÿæˆ</p>
</li>
</ul>
<blockquote>
<p>ç”±äºåè®®ç¼“å†²åŒºç±»åŸºæœ¬ä¸Šæ˜¯å“‘æ•°æ®æŒæœ‰è€…ï¼ˆå¦‚Cä¸­çš„strcutsï¼‰ï¼Œæ‰€ä»¥æ³¨æ„è¿™é‡Œè¦æ‹“å±•æ•°æ®ç±»çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€äº›è¡Œä¸ºï¼Œä¸å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œå› ä¸ºè¿™å°†æ‰“ç ´protocol bufferå†…éƒ¨çš„æœºåˆ¶ã€‚å¯ä»¥é€šè¿‡åŒ…è£…(wrap)æ•°æ®ç±»åˆ°ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ç±»ä¸­ã€‚ï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰</p>
</blockquote>
</li>
<li><p>å°è¯•å†™å…¥æ–‡ä»¶</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.tutorial.AddressBookProtos.AddressBook;</span><br><span class="line"><span class="keyword">import</span> com.example.tutorial.AddressBookProtos.Person;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddPerson</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This function fills in a Person message based on user input.</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> Person <span class="title">PromptForAddress</span><span class="params">(BufferedReader stdin,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 PrintStream stdout)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Person.Builder person = Person.newBuilder();</span><br><span class="line"></span><br><span class="line">    stdout.print(<span class="string">"Enter person ID: "</span>);</span><br><span class="line">    person.setId(Integer.valueOf(stdin.readLine()));</span><br><span class="line"></span><br><span class="line">    stdout.print(<span class="string">"Enter name: "</span>);</span><br><span class="line">    person.setName(stdin.readLine());</span><br><span class="line"></span><br><span class="line">    stdout.print(<span class="string">"Enter email address (blank for none): "</span>);</span><br><span class="line">    String email = stdin.readLine();</span><br><span class="line">    <span class="keyword">if</span> (email.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      person.setEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      stdout.print(<span class="string">"Enter a phone number (or leave blank to finish): "</span>);</span><br><span class="line">      String number = stdin.readLine();</span><br><span class="line">      <span class="keyword">if</span> (number.length() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      Person.PhoneNumber.Builder phoneNumber =</span><br><span class="line">        Person.PhoneNumber.newBuilder().setNumber(number);</span><br><span class="line"></span><br><span class="line">      stdout.print(<span class="string">"Is this a mobile, home, or work phone? "</span>);</span><br><span class="line">      String type = stdin.readLine();</span><br><span class="line">      <span class="keyword">if</span> (type.equals(<span class="string">"mobile"</span>)) &#123;</span><br><span class="line">        phoneNumber.setType(Person.PhoneType.MOBILE);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"home"</span>)) &#123;</span><br><span class="line">        phoneNumber.setType(Person.PhoneType.HOME);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"work"</span>)) &#123;</span><br><span class="line">        phoneNumber.setType(Person.PhoneType.WORK);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        stdout.println(<span class="string">"Unknown phone type.  Using default."</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      person.addPhones(phoneNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> person.build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Main function:  Reads the entire address book from a file,</span></span><br><span class="line">  <span class="comment">//   adds one person based on user input, then writes it back out to the same</span></span><br><span class="line">  <span class="comment">//   file.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length != <span class="number">1</span>) &#123;</span><br><span class="line">      System.err.println(<span class="string">"Usage:  AddPerson ADDRESS_BOOK_FILE"</span>);</span><br><span class="line">      System.exit(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AddressBook.Builder addressBook = AddressBook.newBuilder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read the existing address book.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      addressBook.mergeFrom(<span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">      System.out.println(args[<span class="number">0</span>] + <span class="string">": File not found.  Creating a new file."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add an address.</span></span><br><span class="line">    addressBook.addPeople(</span><br><span class="line">      PromptForAddress(<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in)),</span><br><span class="line">                       System.out));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write the new address book back to disk.</span></span><br><span class="line">    FileOutputStream output = <span class="keyword">new</span> FileOutputStream(args[<span class="number">0</span>]);</span><br><span class="line">    addressBook.build().writeTo(output);</span><br><span class="line">    output.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å°è¯•è¯»å–æ–‡ä»¶</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.example.tutorial.AddressBookProtos.AddressBook;</span><br><span class="line"><span class="keyword">import</span> com.example.tutorial.AddressBookProtos.Person;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListPeople</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Iterates though all people in the AddressBook and prints info about them.</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Print</span><span class="params">(AddressBook addressBook)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Person person: addressBook.getPeopleList()) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Person ID: "</span> + person.getId());</span><br><span class="line">      System.out.println(<span class="string">"  Name: "</span> + person.getName());</span><br><span class="line">      <span class="keyword">if</span> (person.hasEmail()) &#123;</span><br><span class="line">        System.out.println(<span class="string">"  E-mail address: "</span> + person.getEmail());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (Person.PhoneNumber phoneNumber : person.getPhonesList()) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (phoneNumber.getType()) &#123;</span><br><span class="line">          <span class="keyword">case</span> MOBILE:</span><br><span class="line">            System.out.print(<span class="string">"  Mobile phone #: "</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> HOME:</span><br><span class="line">            System.out.print(<span class="string">"  Home phone #: "</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> WORK:</span><br><span class="line">            System.out.print(<span class="string">"  Work phone #: "</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(phoneNumber.getNumber());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Main function:  Reads the entire address book from a file and prints all</span></span><br><span class="line">  <span class="comment">//   the information inside.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length != <span class="number">1</span>) &#123;</span><br><span class="line">      System.err.println(<span class="string">"Usage:  ListPeople ADDRESS_BOOK_FILE"</span>);</span><br><span class="line">      System.exit(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read the existing address book.</span></span><br><span class="line">    AddressBook addressBook =</span><br><span class="line">      AddressBook.parseFrom(<span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">    Print(addressBook);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>å¦‚ä½•æ‹“å±•ä¸€ä¸ªprotocol bufferï¼ˆæ–°bufferså‘ä¸‹å…¼å®¹ï¼Œæ—§bufferså‘ä¸Šå…¼å®¹ï¼‰(<u><strong>è€ƒè™‘çš„æ˜¯æ–°æ—§ä»£ç ä¸Šçš„å…¼å®¹</strong></u>)</p>
<ul>
<li>you <em>must not</em> change the tag numbers of any existing fields.</li>
<li>you <em>must not</em> add or delete any required fields.</li>
<li>you <em>may</em> delete optional or repeated fields.</li>
<li>you <em>may</em> add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).</li>
</ul>
<p>å¯¹äºåˆ é™¤çš„å¯é€‰å­—æ®µ</p>
<ul>
<li>è¯»å–æ–°çš„æ–‡ä»¶æ—¶ï¼Œæ—§ä»£ç è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤å€¼ï¼Œåˆ™æ˜¯å¯¹åº”ç±»å‹çš„é»˜è®¤å€¼ã€‚é‡å¤å­—æ®µä¸ºç©ºã€‚</li>
<li>è¯»å–æ—§çš„æ–‡ä»¶æ—¶ï¼Œæ–°ä»£ç ä¼šé€æ˜è¯»å–ï¼Œå³å¿½ç•¥è¢«åˆ é™¤çš„å­—æ®µã€‚</li>
</ul>
<p>å¯¹äºæ–°å¢çš„å¯é€‰å­—æ®µ</p>
<ul>
<li>è¯»å–æ–°çš„æ–‡ä»¶æ—¶ï¼Œæ—§ä»£ç ä¼šé€æ˜è¯»å–ï¼Œå³å¿½ç•¥è¢«åˆ é™¤çš„å­—æ®µã€‚</li>
<li>è¯»å–æ—§çš„æ–‡ä»¶æ—¶ï¼Œæ–°ä»£ç è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤å€¼ï¼Œåˆ™æ˜¯å¯¹åº”ç±»å‹çš„é»˜è®¤å€¼ã€‚é‡å¤å­—æ®µä¸ºç©ºã€‚</li>
</ul>
</li>
<li><p>é«˜çº§åº”ç”¨ï¼ˆåå°„ï¼‰ã€ä»¥ä¸‹ä¸ºgoogleç¿»è¯‘ã€‘</p>
<p>åè®®æ¶ˆæ¯ç±»æä¾›çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯åå°„ã€‚ æ‚¨å¯ä»¥è¿­ä»£æ¶ˆæ¯çš„å­—æ®µå¹¶æ“ä½œå®ƒä»¬çš„å€¼ï¼Œè€Œæ— éœ€é’ˆå¯¹ä»»ä½•ç‰¹å®šæ¶ˆæ¯ç±»å‹ç¼–å†™ä»£ç ã€‚ ä½¿ç”¨åå°„çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•æ˜¯å°†åè®®æ¶ˆæ¯è½¬æ¢ä¸ºå…¶ä»–ç¼–ç ï¼ˆä¾‹å¦‚XMLæˆ–JSONï¼‰ä»¥åŠä»å…¶ä»–ç¼–ç è½¬æ¢ã€‚ æ›´é«˜çº§çš„åå°„ä½¿ç”¨å¯èƒ½æ˜¯æ‰¾åˆ°ä¸¤ä¸ªç›¸åŒç±»å‹çš„æ¶ˆæ¯ä¹‹é—´çš„å·®å¼‚ï¼Œæˆ–è€…å¼€å‘ä¸€ç§â€œåè®®æ¶ˆæ¯çš„æ­£åˆ™è¡¨è¾¾å¼â€ï¼Œåœ¨å…¶ä¸­å¯ä»¥ç¼–å†™åŒ¹é…ç‰¹å®šæ¶ˆæ¯å†…å®¹çš„è¡¨è¾¾å¼ã€‚ å¦‚æœæ‚¨ä½¿ç”¨è‡ªå·±çš„æƒ³è±¡åŠ›ï¼Œå¯ä»¥å°†Protocol Buffersåº”ç”¨äºæ¯”æ‚¨æœ€åˆæœŸæœ›çš„æ›´å¹¿æ³›çš„é—®é¢˜ï¼</p>
</li>
</ul>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>æœ¬è´¨ä¸Šå°±æ˜¯æä¾›äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œå®Œæˆæ•°æ®çš„å®šä¹‰å’Œæ•°æ®åœ¨å…·ä½“ä»£ç ä¸­å®ç°ï¼ˆæä¾›çš„APIï¼šgetsetï¼Œåºåˆ—åŒ–ï¼Œè§£ç ç¼–ç ï¼Œbuilder-mergeç­‰ï¼‰çš„è§£è€¦ã€‚</p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="https://developers.google.com/protocol-buffers/docs/javatutorial" target="_blank" rel="noopener">protocol buffers java tutorial</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.youshouldknow.tech/2019/01/13/some-exprience-about-hexo-first-use-it/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frank Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zy_avatar.jepg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouShouldKnow">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/13/some-exprience-about-hexo-first-use-it/" itemprop="url">hexo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-13T02:23:02+08:00">
                2019-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/zy_avatar.jepg" alt="Frank Zhang">
          <p class="site-author-name" itemprop="name">Frank Zhang</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/pilife" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhang-yi-14-85-5/activities" target="_blank" title="ZhiHu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      ZhiHu
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2019 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Frank Zhang</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
