---
title: 不懂这些，计算机网络你可能一无所知?
date: 2019-03-15 21:45:17
tags:
- tcp
- udp
- ip
categories:
- youshouldknow
---

- 网络分层

  | Layer       | Protocol                |
  | ----------- | ----------------------- |
  | Application | Telnet, FTP, etc        |
  | Transport   | TCP, UDP                |
  | Network     | IP, ICMP                |
  | Link        | drivers, interface card |

- 数据的单元：报文，报文段，分组/包，数据报，帧，数据单元

  - Application Layer -> 报文（message）
  - Transport Layer -> TCP -> 报文段（segment）
  - Transport/Network Layer -> UDP/ IP -> 数据报（datagram）
  - Transport/Network Layer -> 分组/包（packet）
  - Link Layer -> 帧（frame）

- TCP

  1. TCP Segment

     ![img](https://ws3.sinaimg.cn/large/006tKfTcgy1g13ip2xmihj30kp072jrj.jpg)

     以太网数据包（frame）的大小是固定的，最初是1518字节，后来增加到1522字节。其中， 1500 字节是负载（payload），22字节是头信息（head）。

     ![ip packet](https://ws1.sinaimg.cn/large/006tKfTcgy1g13j80o5d6g30bm06qmwy.gif)

     IP 数据包在以太网数据包的负载里面，它也有自己的头信息，最少需要20字节，所以 IP 数据包的负载最多为1480字节。

     ![tcp packet](https://ws2.sinaimg.cn/large/006tKfTcgy1g13j7708d2g30b708i3yb.gif)

     TCP 数据包在 IP 数据包的负载里面。它的头信息最少也需要20字节，因此 TCP 数据包的最大负载是 1480 - 20 = 1460 字节。由于 IP 和 TCP 协议往往有额外的头信息，所以 TCP 负载实际为1400字节左右。

     因此，一条1500字节的信息需要两个 TCP 数据包。HTTP/2 协议的一大改进， 就是压缩 HTTP 协议的头信息，使得一个 HTTP 请求可以放在一个 TCP 数据包里面，而不是分成多个，这样就提高了速度。

     ![img](https://ws2.sinaimg.cn/large/006tKfTcgy1g13ivy3aetj30ix08j3yf.jpg)

  2. 流程

     1. 建立连接：三次握手
     2. 发送数据
        1. 滑动窗口
        2. 慢启动
     3. 断开连接：四次挥手

  3. 优点

     - 面向连接
     - 具备顺序控制
     - 重发控制等机制

  4. 应用场景

     可以为应用提供可靠的传输。

- UDP

  1. UDP packet

     ![img](https://ws2.sinaimg.cn/large/006tKfTcgy1g13jpm4luog30aa03a3y9.gif)

  2. 流程

  3. 优点

     > UDP数据包长度
     >
     > 在本机(loopback)传输，可以根据需要设置MTU，但记住，UDP最大理论长度65507。
     >
     > 在内网传输，最好控制在1472字节(1500-8-20)。
     >
     > 在internet上传输，最好控制在548字节(576-8-20)以内。

     >  UDP收包能力
     >
     > UDP处理能力非常可观，在日常的业务情形中，UDP一般不会成为性能瓶颈。
     >
     > 随着进程个数的增加，处理能力未明显上升，但是丢包个数明显下降。
     >
     > 采用多进程监听不同端口的模型，而不是多进程或多线程监听同一个端口。

  4. 应用场景

     media streaming 

- IP分片与重组

  

Reference:

> [Exploring the anatomy of a data packet](https://stackoverflow.com/questions/11636405/definition-of-network-units-fragment-segment-packet-frame-datagram)
>
> [Definition of Network Units: Fragment, Segment, Packet, Frame, Datagram](https://www.techrepublic.com/article/exploring-the-anatomy-of-a-data-packet/)
>
> [IP分片和重组](https://blog.csdn.net/github_35124642/article/details/52006185)
>
> [浅谈UDP(数据包长度，收包能力，丢包及进程结构选择)](https://www.cnblogs.com/linuxbug/p/4906000.html)